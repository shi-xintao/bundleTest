window.__require=function t(e,n,i){function o(r,c){if(!n[r]){if(!e[r]){var s=r.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!c&&p)return p(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){return o(e[r][1][t]||t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({Gallery:[function(t,e,n){"use strict";cc._RF.push(e,"fa53cb74GhH4J4O5x/ciVbL","Gallery");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r},r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{s(i.next(t))}catch(e){a(e)}}function c(t){try{s(i.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,c)}s((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(t){return function(e){return s([t,e])}}function s(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../PaintDataManager"),p=t("./galleryitem"),u=t("../tianSeManager"),l=t("../../../../kit/framework/load/ResLoader"),h=t("../paintAssetsManager"),f=t("../paintConfig"),d=cc._decorator,y=d.ccclass,_=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemPrefab=null,e.listNode=null,e.frame_arr=[],e.select_Index=-1,e.paintItemComponentMap=new Map,e}return o(e,t),e.prototype.onLoad=function(){console.log("\u8fdb\u5165\u753b\u5eca ===")},e.prototype.start=function(){this.loadPaintFrame()},e.prototype.loadPaintFrame=function(){return r(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=s.default.getSavePaintData(),[4,Promise.all(t.map(function(t){return new Promise(function(e){l.default.loadRes(t.image,cc.Texture2D,function(n,i){h.paintAssetsManager.instance.setPaintTextureById(t.id,i),e()},f.BUNDLE_NAME)})}))];case 1:return e.sent(),this.initList(),[2]}})})},e.prototype.initList=function(){var t=this;s.default.getPaintListData().forEach(function(e,n){var i=cc.instantiate(t.itemPrefab),o=i.getComponent(p.default);o.init(e),i.position=t.listNode.children[n].position,t.paintItemComponentMap.set(n,o),t.node.addChild(i)})},e.prototype.refreshItem=function(){var t=u.tianSeManager.instance.gallery_index,e=this.paintItemComponentMap.get(t),n=s.default.getPaintDataById(t);e.init(n)},e.prototype.onDestroy=function(){},a([_(cc.Prefab)],e.prototype,"itemPrefab",void 0),a([_(cc.Node)],e.prototype,"listNode",void 0),a([y],e)}(cc.Component);n.default=g,cc._RF.pop()},{"../../../../kit/framework/load/ResLoader":void 0,"../PaintDataManager":"PaintDataManager","../paintAssetsManager":"paintAssetsManager","../paintConfig":"paintConfig","../tianSeManager":"tianSeManager","./galleryitem":"galleryitem"}],PaintDataManager:[function(t,e,n){"use strict";cc._RF.push(e,"a6881QV12NEo5SeJSTmbZGt","PaintDataManager"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../../../kit/utils/LocalStorageUtils"),o=t("./paintConfig"),a=function(){function t(){this.paintItemList=[]}return t.prototype.init=function(){for(var t=o.PAINT_DATA_CONFIG,e=i.LocalStorageUtils.getObject("PAINT_ITEM_LIST_SAVE_KEY")||{},n=t.length,a=0;a<n;a++){var r=t[a];e[r.id]&&(r.isSave=e[r.id].isSave,r.islock=e[r.id].islock),this.paintItemList[a]=r}cc.log(" ===this.paintItemList: ",this.paintItemList)},t.prototype.getFreePaint=function(){return this.paintItemList.filter(function(t){return 1==t.isfree})},t.prototype.getSavePaintData=function(){return this.paintItemList.filter(function(t){return 1==t.isSave})},t.prototype.getPaintListData=function(){return this.paintItemList},t.prototype.getNativePathByIndex=function(t){return this.paintItemList[t].native_path},t.prototype.getPaintDataById=function(t){return this.paintItemList.find(function(e){return e.id==t})},t.prototype.setPaintItemUnlockById=function(t){var e=this.paintItemList.find(function(e){return e.id==t});e.isSave=!0,console.log("\u4fdd\u5b58\u4e86\u56fe\u7247----\x3e"+e.native_path),this.save()},t.prototype.save=function(){var t={};this.paintItemList.forEach(function(e){var n=e.id;t[n]={},t[n].isSave=e.isSave,t[n].islock=e.islock}),i.LocalStorageUtils.setObject("PAINT_ITEM_LIST_SAVE_KEY",t)},Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!1,configurable:!0}),t}();n.default=a.instance,cc._RF.pop()},{"../../../kit/utils/LocalStorageUtils":void 0,"./paintConfig":"paintConfig"}],galleryitem:[function(t,e,n){"use strict";cc._RF.push(e,"2d372meuHpDIZtpsckUFjo9","galleryitem");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../paintAssetsManager"),c=t("../tianSeManager"),s=cc._decorator,p=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lock=null,e.light=null,e.mubu=null,e.paint=null,e.itemInfo={},e.texture=null,e.isClick=!1,e}return o(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t){if(cc.log("\u8fdb\u5165\u5237\u65b0\u56fe\u6848=========="+t.id),this.isClick=!0,this.itemInfo=t,t.isSave){var e=r.paintAssetsManager.instance.getPaintTextureById(t.id),n=new cc.SpriteFrame;n.setTexture(e),this.paint.getComponent(cc.Sprite).spriteFrame=n}this.light.active=1==t.isSave,this.mubu.active=0==t.islock},e.prototype.clickEvent=function(){this.itemInfo.islock&&this.isClick&&(c.tianSeManager.instance.openPaint(this.itemInfo),c.tianSeManager.instance.gallery_index=this.itemInfo.id,this.paint.getComponent(cc.Sprite).spriteFrame=null)},a([u(cc.Node)],e.prototype,"lock",void 0),a([u(cc.Node)],e.prototype,"light",void 0),a([u(cc.Node)],e.prototype,"mubu",void 0),a([u(cc.Node)],e.prototype,"paint",void 0),a([p],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../paintAssetsManager":"paintAssetsManager","../tianSeManager":"tianSeManager"}],paintAlert:[function(t,e,n){"use strict";cc._RF.push(e,"a7858WbbtRLObengVBsNrMe","paintAlert");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../src/tianSeManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return o(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(){},e.prototype.onClickClose=function(){this.node.active=!1,r.tianSeManager.instance.MainNode.tianseNode.active=!1,r.tianSeManager.instance.MainNode.refreshItem()},e.prototype.onClickOk=function(){this.node.active=!1},a([p(cc.Label)],e.prototype,"label",void 0),a([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../src/tianSeManager":"tianSeManager"}],paintAssetsManager:[function(t,e,n){"use strict";cc._RF.push(e,"e70d9ECa11KLYrgTlESpxT7","paintAssetsManager"),Object.defineProperty(n,"__esModule",{value:!0}),n.paintAssetsManager=void 0;var i=function(){function t(){this.paintTextureMap=new Map}return t.prototype.setPaintTextureById=function(t,e){var n=this.paintTextureMap.get(t);this.paintTextureMap.set(t,e),console.log("\u6dfb\u52a0\u7f13\u5b58\u4e0b\u6765\u7684\u56fe\u7247",n)},t.prototype.getPaintTextureById=function(t){return console.log("\u8bfb\u53d6\u5230\u4e86\u7f13\u5b58",this.paintTextureMap.get(t)),this.paintTextureMap.get(t)},t.prototype.getPaintTextureData=function(){return this.paintTextureMap},Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!1,configurable:!0}),t}();n.paintAssetsManager=i,cc._RF.pop()},{}],paintConfig:[function(t,e,n){"use strict";cc._RF.push(e,"620a7aW6r1OIbGbs7spmsWJ","paintConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.MUSIC_PATH=n.MESSAGE_IN_GALLERY=n.SAVE_PAINT_SIGN=n.PAINT_DATA_CONFIG=n.COLOR_INDEX=n.COLOR_CONFIG=n.Music=n.GUIDE_STATE=n.BUNDLE_NAME=void 0,n.BUNDLE_NAME="paint",function(t){t.INIT="init",t.CLICK_HB="clickHb",t.CLICK_FILL="clickFill",t.DONE="done"}(n.GUIDE_STATE||(n.GUIDE_STATE={})),function(t){t.bgm="BGM_tuse_01",t.clickHb="SE_tuse_01",t.clickFill="SE_tuse_02",t.done="SE_tuse_03"}(n.Music||(n.Music={})),n.COLOR_CONFIG=["#EFEFEF","#FFB532","#FC869D","#313131","#FC5D38","#FFDD4C","#2FAEE5","#81EA3D","#8F56FF"],n.COLOR_INDEX=[[4,5,6,1,2,8],[7,5,2,1,6,0],[1,5,4,7,8,0]],n.PAINT_DATA_CONFIG=[{id:0,isfree:!0,islock:!0,isSave:!1,image:"res/ts/paint1",native_path:"paint1.png"},{id:1,isfree:!0,islock:!0,isSave:!1,image:"res/ts/paint2",native_path:"paint2.png"},{id:2,isfree:!0,islock:!0,isSave:!1,image:"res/ts/paint3",native_path:"paint3.png"},{id:3,isfree:!1,islock:!1,isSave:!1,image:"res/ts/paint4",native_path:"paint4.png"}],n.SAVE_PAINT_SIGN="save_paint",n.MESSAGE_IN_GALLERY="open_gallery",n.MUSIC_PATH="audio/",cc._RF.pop()},{}],paintMain:[function(t,e,n){"use strict";cc._RF.push(e,"048f428ivlEjaT0QZAYOfOY","paintMain");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../../../kit/events/events"),c=t("../../../../kit/system/event/EventSystem"),s=t("../tianSeManager"),p=t("./Gallery"),u=t("./tianSeNodeInGallery"),l=cc._decorator,h=l.ccclass,f=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.contentNode=null,e.galleryPre=null,e.tiansePre=null,e.quitAlertPre=null,e.quitAlertNode=null,e.galleryNode=null,e.tianseNode=null,e}return o(e,t),e.prototype.onLoad=function(){s.tianSeManager.instance.init(this,0,-1),this.galleryNode=cc.instantiate(this.galleryPre),this.node.addChild(this.galleryNode),this.galleryNode.active=!0},e.prototype.start=function(){this.tianseNode=cc.instantiate(this.tiansePre),this.node.addChild(this.tianseNode),this.tianseNode.active=!1,this.quitAlertNode=cc.instantiate(this.quitAlertPre),this.node.addChild(this.quitAlertNode),this.quitAlertNode.active=!1},e.prototype.openPaint=function(t){c.default.emit(r.SET_TOP_BAR_ACTIVE,{active:!1}),this.tianseNode.active=!0,this.tianseNode.getComponent(u.default).initPaint(t)},e.prototype.closePaint=function(){this.tianseNode.active=!1,c.default.emit(r.SET_TOP_BAR_ACTIVE,{active:!0})},e.prototype.refreshItem=function(){this.galleryNode.getComponent(p.default).refreshItem()},e.prototype.showQuitAlertPre=function(){this.quitAlertNode.active=!0},a([f(cc.Node)],e.prototype,"contentNode",void 0),a([f(cc.Prefab)],e.prototype,"galleryPre",void 0),a([f(cc.Prefab)],e.prototype,"tiansePre",void 0),a([f(cc.Prefab)],e.prototype,"quitAlertPre",void 0),a([h],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../../../../kit/events/events":void 0,"../../../../kit/system/event/EventSystem":void 0,"../tianSeManager":"tianSeManager","./Gallery":"Gallery","./tianSeNodeInGallery":"tianSeNodeInGallery"}],paintTopBar:[function(t,e,n){"use strict";cc._RF.push(e,"ab6c8UQemRH2LNqyjQFw29j","paintTopBar");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../src/tianSeManager"),c=cc._decorator,s=c.ccclass,p=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onBack=function(){r.tianSeManager.instance.showQuitAlertPre()},e.prototype.onNext=function(){},a([s],e)}(cc.Component));n.default=p,cc._RF.pop()},{"../src/tianSeManager":"tianSeManager"}],paint:[function(t,e,n){"use strict";cc._RF.push(e,"4b259wqiEFA/oB5ZfxGqy+O","paint");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../kit/system/event/EventSystem"),c=t("../../kit/utils/LocalStorageUtils"),s=t("./src/paintConfig"),p=t("./src/PaintDataManager"),u=cc._decorator,l=u.ccclass,h=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=null,e.firstPaintGame=null,e.paintGroup=null,e.isPaint=!1,e.isPaint_key="isPaint",e}return o(e,t),e.prototype.start=function(){},e.prototype.onLoad=function(){this.regisEvent(),p.default.init(),this.isPaint=c.LocalStorageUtils.getBool(s.SAVE_PAINT_SIGN),this.initUI(),console.log("\u662f\u5426\u4fdd\u5b58\u8fc7\u56fe\u7247---\x3e",+this.isPaint)},e.prototype.openPaint=function(){this.content.removeAllChildren();var t=cc.instantiate(this.firstPaintGame);this.content.addChild(t)},e.prototype.openPaintGroup=function(){this.content.removeAllChildren();var t=cc.instantiate(this.paintGroup);this.content.addChild(t)},e.prototype.initUI=function(){this.isPaint?this.openPaintGroup():this.openPaint()},e.prototype.regisEvent=function(){r.default.on(s.MESSAGE_IN_GALLERY,this.openPaintGroup,this)},e.prototype.onDestroy=function(){r.default.off(s.MESSAGE_IN_GALLERY,this.openPaintGroup,this)},a([h(cc.Node)],e.prototype,"content",void 0),a([h(cc.Prefab)],e.prototype,"firstPaintGame",void 0),a([h(cc.Prefab)],e.prototype,"paintGroup",void 0),a([l],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../../kit/system/event/EventSystem":void 0,"../../kit/utils/LocalStorageUtils":void 0,"./src/PaintDataManager":"PaintDataManager","./src/paintConfig":"paintConfig"}],pen:[function(t,e,n){"use strict";cc._RF.push(e,"f86fcM2TflBIZoB3rL3g9kQ","pen");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./paintConfig"),c=t("./tianSeManager"),s=t("../../../kit/system/audio/AudioManager"),p=cc._decorator,u=p.ccclass,l=p.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.penList=[],e.basicX=80,e}return o(e,t),e.prototype.onLoad=function(){this.refreshColorNode()},e.prototype.refreshColorNode=function(){for(var t=this.penList.length,e=c.tianSeManager.instance.TanseIndex,n=c.tianSeManager.instance.ColorIndex,i=r.COLOR_INDEX[e],o=0;o<t;o++){var a=o==n,s=this.penList[o],p=s.getChildByName("floor"),u=s.getChildByName("select"),l=s.getChildByName("unselect"),h=r.COLOR_CONFIG[i[o]];p.color=(new cc.Color).fromHEX(h),u.active=a,l.active=!a,s.x=1==a?37:this.basicX,a&&(c.tianSeManager.instance.CurColor=p.color)}},e.prototype.clickEventBack=function(t,e){e!=c.tianSeManager.instance.ColorIndex&&(c.tianSeManager.instance.ColorIndex=Number(e),this.refreshColorNode(),c.tianSeManager.instance.guideState==r.GUIDE_STATE.INIT&&(c.tianSeManager.instance.guideState=r.GUIDE_STATE.CLICK_HB,c.tianSeManager.instance.setGuide()),s.default.playEffect(r.BUNDLE_NAME,""+r.MUSIC_PATH+r.Music.clickHb))},a([l(cc.Node)],e.prototype,"penList",void 0),a([u],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../../kit/system/audio/AudioManager":void 0,"./paintConfig":"paintConfig","./tianSeManager":"tianSeManager"}],showPaint:[function(t,e,n){"use strict";cc._RF.push(e,"81b03MOTrJGgYTzdK3DkdJU","showPaint");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../tianSeManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scaleNode=null,e.showNode=[],e.isTouch=!1,e.left_pos=cc.v3(0,0),e.right_pos=cc.v3(0,0),e.left_light=null,e.right_light=null,e}return o(e,t),e.prototype.onLoad=function(){this.recordLightPos(),this.node.on(cc.Node.EventType.TOUCH_START,this.touchStart,this)},e.prototype.onEnable=function(){this.scaleNode.scale=1.5,this.showNode.map(function(t){return t.active=!1})},e.prototype.recordLightPos=function(){this.left_light=this.node.getChildByName("left_light"),this.right_light=this.node.getChildByName("right_light"),this.left_pos=this.left_light.position,this.right_pos=this.right_light.position},e.prototype.setScaleNode=function(){var t=this,e=this.node.getChildByName("left_node"),n=this.node.getChildByName("right_node");this.left_light.position=this.left_pos,this.right_light.position=this.right_pos,cc.tween(this.left_light).to(1,{position:e.position}).start(),cc.tween(this.right_light).to(1,{position:n.position}).start(),cc.tween(this.scaleNode).to(1,{scale:1}).call(function(){return t.isTouch=!0}).start()},e.prototype.touchStart=function(){this.isTouch&&(this.isTouch=!1,r.tianSeManager.instance.change())},e.prototype.setShowImage=function(t,e){var n=new cc.Texture2D,i=this.showNode[e];i.active=!0;var o=new cc.SpriteFrame;n.initWithData(this.filpYImage(t,i.width,i.height),cc.Texture2D.PixelFormat.RGBA8888,i.width,i.height),o.setTexture(n),i.getComponent(cc.Sprite).spriteFrame=o,this.setScaleNode()},e.prototype.filpYImage=function(t,e,n){for(var i=new Uint8Array(e*n*4),o=4*e,a=0;a<n;a++)for(var r=(n-1-a)*e*4,c=a*e*4,s=0;s<o;s++)i[c+s]=t[r+s];return i},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.touchStart,this)},a([p(cc.Node)],e.prototype,"scaleNode",void 0),a([p(cc.Node)],e.prototype,"showNode",void 0),a([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../tianSeManager":"tianSeManager"}],tanseMain:[function(t,e,n){"use strict";cc._RF.push(e,"5bcd4t0tDNDUbPT36L9ieiu","tanseMain");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./tianSeNode"),c=t("../paintConfig"),s=t("../pen"),p=t("./showPaint"),u=t("../tianSeManager"),l=cc._decorator,h=l.ccclass,f=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.penPre=null,e.guidePre=null,e.tansePre=null,e.showPaintPre=null,e.isGuide=!0,e.penNode=null,e.guideNode=null,e.tanseNode=null,e.showPaintNode=null,e}return o(e,t),e.prototype.onLoad=function(){u.tianSeManager.instance.init(this,0,-1,!0),this.tanseNode=cc.instantiate(this.tansePre),this.node.addChild(this.tanseNode),this.penNode=cc.instantiate(this.penPre),this.node.addChild(this.penNode)},e.prototype.start=function(){this.guideNode=cc.instantiate(this.guidePre),this.node.addChild(this.guideNode),this.showPaintNode=cc.instantiate(this.showPaintPre),this.node.addChild(this.showPaintNode),this.tanseNode.getChildByName("done").active=!1,this.setGuide(),this.guideNode.active=!1,this.showPaintNode.active=!1},e.prototype.showPaint=function(){this.showPaintNode.active=!0,this.tanseNode.getChildByName("done").active=!1;var t=u.tianSeManager.instance.TanseIndex,e=u.tianSeManager.instance.CurTextureData;this.showPaintNode.getComponent(p.default).setShowImage(e,t)},e.prototype.nextPaint=function(){this.showPaintNode.active=!1,this.tanseNode.getChildByName("done").active=!0,this.penNode.getComponent(s.default).refreshColorNode(),this.tanseNode.getComponent(r.default).initPaint()},e.prototype.setGuide=function(){var t=this;if(this.isGuide&&u.tianSeManager.instance.guideState!=c.GUIDE_STATE.DONE)switch(this.guideNode.active=!1,this.unscheduleAllCallbacks(),u.tianSeManager.instance.guideState){case c.GUIDE_STATE.INIT:this.scheduleOnce(function(){t.guideNode.active=!0,t.guideNode.x=t.penNode.x+100},2);break;case c.GUIDE_STATE.CLICK_HB:this.scheduleOnce(function(){t.guideNode.active=!0,t.guideNode.x=t.tanseNode.x-100},2);break;case c.GUIDE_STATE.CLICK_FILL:u.tianSeManager.instance.guideState=c.GUIDE_STATE.DONE,this.tanseNode.getChildByName("done").active=!0}},a([f(cc.Prefab)],e.prototype,"penPre",void 0),a([f(cc.Prefab)],e.prototype,"guidePre",void 0),a([f(cc.Prefab)],e.prototype,"tansePre",void 0),a([f(cc.Prefab)],e.prototype,"showPaintPre",void 0),a([h],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../paintConfig":"paintConfig","../pen":"pen","../tianSeManager":"tianSeManager","./showPaint":"showPaint","./tianSeNode":"tianSeNode"}],tianSeManager:[function(t,e,n){"use strict";cc._RF.push(e,"4db9fhi+65HMLQLu9HallKy","tianSeManager");var i=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0}),n.tianSeManager=void 0;var o=t("../../../kit/system/event/EventSystem"),a=t("./paintConfig"),r=cc._decorator,c=r.ccclass,s=(r.property,function(){function t(){this.guideState="",this.curTextureData={},this.MainNode=null,this.tanse_index=null,this.gallery_index=null,this.color_index=null,this.max_tanse_index=3,this.cur_Color=cc.color(255,255,255)}var e;return e=t,t.prototype.init=function(t,e,n,i){void 0===i&&(i=!1),this.tanse_index=e,this.color_index=n,this.MainNode=t,i&&(this.guideState=a.GUIDE_STATE.INIT)},t.prototype.change=function(){e.instance.TanseIndex++,this.tanse_index>=this.max_tanse_index?o.default.emit(a.MESSAGE_IN_GALLERY):this.MainNode.nextPaint()},t.prototype.openPaint=function(t){this.MainNode.openPaint(t)},t.prototype.closePaint=function(){this.MainNode.refreshItem(),this.MainNode.closePaint()},t.prototype.showPaint=function(){this.MainNode.showPaint()},t.prototype.showQuitAlertPre=function(){this.MainNode.showQuitAlertPre()},t.prototype.setGuide=function(){this.MainNode.setGuide()},Object.defineProperty(t.prototype,"TanseIndex",{get:function(){return this.tanse_index},set:function(t){this.tanse_index=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CurTextureData",{get:function(){return this.curTextureData},set:function(t){this.curTextureData=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ColorIndex",{get:function(){return this.color_index},set:function(t){this.color_index=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CurColor",{get:function(){return this.cur_Color},set:function(t){this.cur_Color=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e=i([c],t)}());n.tianSeManager=s,cc._RF.pop()},{"../../../kit/system/event/EventSystem":void 0,"./paintConfig":"paintConfig"}],tianSeNodeInGallery:[function(t,e,n){"use strict";cc._RF.push(e,"662435cMblKNpnyGXHKl3UM","tianSeNodeInGallery");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r},r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{s(i.next(t))}catch(e){a(e)}}function c(t){try{s(i.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,c)}s((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(t){return function(e){return s([t,e])}}function s(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../../../../kit/system/audio/AudioManager"),p=t("../../../../kit/framework/load/ResLoader"),u=t("../../src/paintConfig"),l=t("../tianSeManager"),h=t("../paintAssetsManager"),f=cc._decorator,d=f.ccclass,y=f.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.paint_Camera=null,e.paint1=null,e.paint2=null,e.doneBtn=null,e.topMask=null,e.penPre=null,e.topBarPre=null,e.tetTexture=null,e.curDrawTexture2D=null,e.winWidth=0,e.winHeight=0,e.curTextureData={},e.savedTexutreData={},e.b_inited=!1,e.curDrawMode=0,e.checkedPointDic={},e.checkPointList=[],e.paintFrame=[],e.data={},e}return o(e,t),e.prototype.onLoad=function(){this.addEvent();var t=cc.instantiate(this.penPre);this.node.addChild(t);var e=cc.instantiate(this.topBarPre);this.node.addChild(e),s.default.playMusic(u.BUNDLE_NAME,""+u.MUSIC_PATH+u.Music.bgm)},e.prototype.initPaint=function(t){this.data=t,this.loadPaintFrame(t)},e.prototype.loadPaintFrame=function(t){return r(this,void 0,void 0,function(){var e,n,i=this;return c(this,function(){return console.log("\u8981\u52a0\u8f7d\u7684\u56fe\u7247========",t.image),e=h.paintAssetsManager.instance.getPaintTextureById(t.id),(n=new cc.SpriteFrame).setTexture(e),this.paint2.getComponent(cc.Sprite).spriteFrame=n,p.default.loadRes(t.image,cc.SpriteFrame,function(t,e){t&&console.log("\u52a0\u8f7d\u5931\u8d25"),console.log("\u52a0\u8f7d\u6210\u529f"),i.paint1.getComponent(cc.Sprite).spriteFrame=e,i.initView()},u.BUNDLE_NAME),[2]})})},e.prototype.initView=function(){this.curDrawMode=0,this.b_inited=!1,this.topMask.active=!1,this.paint_Camera.ortho=!0,this.paint_Camera.alignWithScreen=!1,this.tetTexture=new cc.RenderTexture,this.curDrawTexture2D=new cc.Texture2D,this.resetRendData()},e.prototype.resetRendData=function(){var t=this;this.paint2.active=!1,this.paint_Camera.orthoSize=.5*this.paint1.height,this.winWidth=this.paint1.width,this.winHeight=this.paint1.height,this.paint2.x=this.paint1.x,this.paint2.y=this.paint1.y,this.paint_Camera.node.x=this.paint1.x,this.paint_Camera.node.y=this.paint1.y,this.paint2.setContentSize(this.paint1.getContentSize()),this.paint_Camera.node.setContentSize(this.paint1.getContentSize()),this.tetTexture._depthStencilBuffer=null,this.tetTexture.initWithSize(this.paint1.width,this.paint1.height,cc.gfx.RB_FMT_S8),this.paint_Camera.targetTexture=this.tetTexture,this.paint_Camera.render(this.paint1),this.paint2.active=!0;var e=this.tetTexture.readPixels();this.savedTexutreData=e.slice();var n=new cc.RenderTexture;n._depthStencilBuffer=null,n.initWithSize(this.paint1.width,this.paint1.height,cc.gfx.RB_FMT_S8),this.paint_Camera.targetTexture=n,this.paint_Camera.render(this.paint2),this.scheduleOnce(function(){t.curTextureData=n.readPixels()},.1),this.b_inited=!0},e.prototype.filpYImage=function(t,e,n){for(var i=new Uint8Array(e*n*4),o=4*e,a=0;a<n;a++)for(var r=(n-1-a)*e*4,c=a*e*4,s=0;s<o;s++)i[c+s]=t[r+s];return i},e.prototype.addEvent=function(){var t=this;this.paint1.on(cc.Node.EventType.TOUCH_END,function(e){if(t.b_inited&&t.curTextureData){var n=e.getLocation(),i=t.paint1.convertToNodeSpaceAR(cc.v2(n.x,n.y));i.x=i.x+.5*t.paint1.width,i.y=i.y+.5*t.paint1.height,t.checkColorFill(Math.floor(i.x),Math.floor(i.y));var o=new cc.SpriteFrame;t.curDrawTexture2D.initWithData(t.filpYImage(t.curTextureData,t.winWidth,t.winHeight),cc.Texture2D.PixelFormat.RGBA8888,t.winWidth,t.winHeight),o.setTexture(t.curDrawTexture2D),t.paint2.getComponent(cc.Sprite).spriteFrame=o}},this)},e.prototype.checkColorFill=function(t,e){if(this.inArea(t,e)){this.checkPointList=[],this.checkedPointDic={},this.checkPushPoint(this.checkedPointDic,{x:t,y:e});var n=this.checkPointList[0],i=Math.floor(this.winWidth*n.y*4+4*n.x);for(this.savedTexutreData[i]+this.savedTexutreData[i+1]+this.savedTexutreData[i+2]&&s.default.playEffect(u.BUNDLE_NAME,""+u.MUSIC_PATH+u.Music.clickFill);this.checkPointList.length>0;){var o=this.checkPointList.pop();if(o&&this.inArea(o.x,o.y)){var a=Math.floor(this.winWidth*o.y*4+4*o.x),r=this.savedTexutreData[a]+this.savedTexutreData[a+1]+this.savedTexutreData[a+2];if(this.savedTexutreData[a+3],r>700){switch(this.curDrawMode){case 0:this.curTextureData[a]=l.tianSeManager.instance.CurColor.r,this.curTextureData[a+1]=l.tianSeManager.instance.CurColor.g,this.curTextureData[a+2]=l.tianSeManager.instance.CurColor.b;break;case-1:this.curTextureData[a]=255,this.curTextureData[a+1]=255,this.curTextureData[a+2]=255}this.checkPushPoint(this.checkedPointDic,{x:o.x,y:o.y+1}),this.checkPushPoint(this.checkedPointDic,{x:o.x,y:o.y-1}),this.checkPushPoint(this.checkedPointDic,{x:o.x+1,y:o.y}),this.checkPushPoint(this.checkedPointDic,{x:o.x-1,y:o.y})}}}}},e.prototype.checkPushPoint=function(t,e){t[e.x]&&t[e.x][e.y]||(t[e.x]||(t[e.x]={}),t[e.x][e.y]=!0,this.checkPointList.push(e))},e.prototype.inArea=function(t,e){return t>=0&&t<=this.winWidth&&e>=0&&e<=this.winHeight},e.prototype.doneCurTs=function(){this.saveFileToLocal(this.curTextureData)},e.prototype.saveFileToLocal=function(){},e.prototype.onDestroy=function(){},a([y(cc.Camera)],e.prototype,"paint_Camera",void 0),a([y(cc.Node)],e.prototype,"paint1",void 0),a([y(cc.Node)],e.prototype,"paint2",void 0),a([y(cc.Node)],e.prototype,"doneBtn",void 0),a([y(cc.Node)],e.prototype,"topMask",void 0),a([y(cc.Prefab)],e.prototype,"penPre",void 0),a([y(cc.Prefab)],e.prototype,"topBarPre",void 0),a([d],e)}(cc.Component);n.default=_,cc._RF.pop()},{"../../../../kit/framework/load/ResLoader":void 0,"../../../../kit/system/audio/AudioManager":void 0,"../../src/paintConfig":"paintConfig","../paintAssetsManager":"paintAssetsManager","../tianSeManager":"tianSeManager"}],tianSeNode:[function(t,e,n){"use strict";cc._RF.push(e,"98173k1sKdONJ0yBSDG+xzt","tianSeNode");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r},r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{s(i.next(t))}catch(e){a(e)}}function c(t){try{s(i.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,c)}s((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(t){return function(e){return s([t,e])}}function s(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../../../../kit/system/audio/AudioManager"),p=t("../../../../kit/framework/load/ResLoader"),u=t("../tianSeManager"),l=t("../paintConfig"),h=t("../../../../kit/utils/LocalStorageUtils"),f=t("../PaintDataManager"),d=t("../paintAssetsManager"),y=cc._decorator,_=y.ccclass,g=y.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.paint_Camera=null,e.paint1=null,e.paint2=null,e.doneBtn=null,e.topMask=null,e.tetTexture=null,e.curDrawTexture2D=null,e.winWidth=0,e.winHeight=0,e.curTextureData={},e.savedTexutreData={},e.b_inited=!1,e.curDrawMode=0,e.checkedPointDic={},e.checkPointList=[],e.paintFrame=[],e}return o(e,t),e.prototype.onLoad=function(){this.addEvent(),this.initPaint(),s.default.playMusic(l.BUNDLE_NAME,""+l.MUSIC_PATH+l.Music.bgm)},e.prototype.initPaint=function(){this.loadPaintFrame()},e.prototype.loadPaintFrame=function(){return r(this,void 0,void 0,function(){var t,e=this;return c(this,function(n){switch(n.label){case 0:return t=f.default.getFreePaint(),[4,Promise.all(t.map(function(t,n){return new Promise(function(i){p.default.loadRes(t.image,cc.SpriteFrame,function(t,o){e.paintFrame[n]=o,i()},l.BUNDLE_NAME)})}))];case 1:return n.sent(),this.initView(),[2]}})})},e.prototype.initView=function(){this.curDrawMode=0,this.b_inited=!1,this.topMask.active=!1,this.paint_Camera.ortho=!0,this.paint_Camera.alignWithScreen=!1,this.tetTexture=new cc.RenderTexture,this.curDrawTexture2D=new cc.Texture2D,this.resetRendData()},e.prototype.resetRendData=function(){var t=this;this.paint2.active=!1;var e=this.paintFrame[u.tianSeManager.instance.TanseIndex];this.paint1.getComponent(cc.Sprite).spriteFrame=e,this.paint_Camera.orthoSize=.5*this.paint1.height,this.winWidth=this.paint1.width,this.winHeight=this.paint1.height,this.paint2.x=this.paint1.x,this.paint2.y=this.paint1.y,this.paint_Camera.node.x=this.paint1.x,this.paint_Camera.node.y=this.paint1.y,this.paint2.setContentSize(this.paint1.getContentSize()),this.paint_Camera.node.setContentSize(this.paint1.getContentSize()),this.tetTexture._depthStencilBuffer=null,this.tetTexture.initWithSize(this.paint1.width,this.paint1.height,cc.gfx.RB_FMT_S8),this.paint_Camera.targetTexture=this.tetTexture,this.paint_Camera.render(this.paint1),this.scheduleOnce(function(){var e=t.tetTexture.readPixels();t.savedTexutreData=e.slice(),t.curTextureData=e.slice(),t.b_inited=!0;var n=new cc.SpriteFrame;t.curDrawTexture2D.initWithData(t.filpYImage(t.curTextureData,t.winWidth,t.winHeight),cc.Texture2D.PixelFormat.RGBA8888,t.winWidth,t.winHeight),n.setTexture(t.curDrawTexture2D),t.paint2.getComponent(cc.Sprite).spriteFrame=n,t.paint2.active=!0},1)},e.prototype.filpYImage=function(t,e,n){for(var i=new Uint8Array(e*n*4),o=4*e,a=0;a<n;a++)for(var r=(n-1-a)*e*4,c=a*e*4,s=0;s<o;s++)i[c+s]=t[r+s];return i},e.prototype.addEvent=function(){var t=this;this.paint1.on(cc.Node.EventType.TOUCH_END,function(e){if(t.b_inited&&t.curTextureData){u.tianSeManager.instance.guideState==l.GUIDE_STATE.CLICK_HB&&(u.tianSeManager.instance.guideState=l.GUIDE_STATE.CLICK_FILL,u.tianSeManager.instance.setGuide());var n=e.getLocation(),i=t.paint1.convertToNodeSpaceAR(cc.v2(n.x,n.y));i.x=i.x+.5*t.paint1.width,i.y=i.y+.5*t.paint1.height,t.checkColorFill(Math.floor(i.x),Math.floor(i.y));var o=new cc.SpriteFrame;t.curDrawTexture2D.initWithData(t.filpYImage(t.curTextureData,t.winWidth,t.winHeight),cc.Texture2D.PixelFormat.RGBA8888,t.winWidth,t.winHeight),o.setTexture(t.curDrawTexture2D),t.paint2.getComponent(cc.Sprite).spriteFrame=o}},this)},e.prototype.checkColorFill=function(t,e){if(this.inArea(t,e)){this.checkPointList=[],this.checkedPointDic={},this.checkPushPoint(this.checkedPointDic,{x:t,y:e});var n=this.checkPointList[0],i=Math.floor(this.winWidth*n.y*4+4*n.x);for(this.savedTexutreData[i]+this.savedTexutreData[i+1]+this.savedTexutreData[i+2]&&s.default.playEffect(l.BUNDLE_NAME,""+l.MUSIC_PATH+l.Music.clickFill);this.checkPointList.length>0;){var o=this.checkPointList.pop();if(o&&this.inArea(o.x,o.y)){var a=Math.floor(this.winWidth*o.y*4+4*o.x),r=this.savedTexutreData[a]+this.savedTexutreData[a+1]+this.savedTexutreData[a+2];if(this.savedTexutreData[a+3],r>700){switch(this.curDrawMode){case 0:this.curTextureData[a]=u.tianSeManager.instance.CurColor.r,this.curTextureData[a+1]=u.tianSeManager.instance.CurColor.g,this.curTextureData[a+2]=u.tianSeManager.instance.CurColor.b;break;case-1:this.curTextureData[a]=255,this.curTextureData[a+1]=255,this.curTextureData[a+2]=255}this.checkPushPoint(this.checkedPointDic,{x:o.x,y:o.y+1}),this.checkPushPoint(this.checkedPointDic,{x:o.x,y:o.y-1}),this.checkPushPoint(this.checkedPointDic,{x:o.x+1,y:o.y}),this.checkPushPoint(this.checkedPointDic,{x:o.x-1,y:o.y})}}}}},e.prototype.checkPushPoint=function(t,e){t[e.x]&&t[e.x][e.y]||(t[e.x]||(t[e.x]={}),t[e.x][e.y]=!0,this.checkPointList.push(e))},e.prototype.inArea=function(t,e){return t>=0&&t<=this.winWidth&&e>=0&&e<=this.winHeight},e.prototype.doneCurTs=function(){u.tianSeManager.instance.CurTextureData=this.curTextureData,u.tianSeManager.instance.showPaint(),this.saveFileToLocal(this.curTextureData),0==u.tianSeManager.instance.TanseIndex&&(cc.log("\u4fdd\u5b58\u4e86\u7b2c\u4e00\u5f20\u56fe\u7247\uff5e\uff5e\uff5e\uff5e"),h.LocalStorageUtils.setBool(l.SAVE_PAINT_SIGN,!0)),s.default.playEffect(l.BUNDLE_NAME,""+l.MUSIC_PATH+l.Music.done),f.default.setPaintItemUnlockById(u.tianSeManager.instance.TanseIndex);var t=f.default.getPaintDataById(u.tianSeManager.instance.TanseIndex);p.default.loadRes(t.image,cc.SpriteFrame,function(e,n){d.paintAssetsManager.instance.setPaintTextureById(t.id,n)},l.BUNDLE_NAME)},e.prototype.saveFileToLocal=function(){},e.prototype.onDestroy=function(){},a([g(cc.Camera)],e.prototype,"paint_Camera",void 0),a([g(cc.Node)],e.prototype,"paint1",void 0),a([g(cc.Node)],e.prototype,"paint2",void 0),a([g(cc.Node)],e.prototype,"doneBtn",void 0),a([g(cc.Node)],e.prototype,"topMask",void 0),a([_],e)}(cc.Component);n.default=v,cc._RF.pop()},{"../../../../kit/framework/load/ResLoader":void 0,"../../../../kit/system/audio/AudioManager":void 0,"../../../../kit/utils/LocalStorageUtils":void 0,"../PaintDataManager":"PaintDataManager","../paintAssetsManager":"paintAssetsManager","../paintConfig":"paintConfig","../tianSeManager":"tianSeManager"}]},{},["paint","paintAlert","paintTopBar","PaintDataManager","showPaint","tanseMain","tianSeNode","Gallery","galleryitem","paintMain","tianSeNodeInGallery","paintAssetsManager","paintConfig","pen","tianSeManager"]);