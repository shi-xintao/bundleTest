{"version":3,"sources":["assets/bundles/recordStarEcho/scripts/RecordStarEchoConfig.ts","assets/bundles/recordStarEcho/scripts/RecordStarEcho.ts"],"names":["StarAniName","exports","StarAudioConfig","GameStartAniConfig","name","Chuchang","loop","SayHello","Idle1","RoundStartAniConfig","ShanShanzi1","ShanShanzi2","SpeakAniConfig","SpeakWithLight2","IdleAniConfig","Idle2","SuccAniConfig","ColorConfig","RecordTxt","ChapterGameComponent_1","require","SpineUtils_1","kit_1","ResourcesManager_1","AudioManager_1","RecordStarEchoConfig_1","_a","cc","_decorator","ccclass","property","RECORDSTARECHO","RecordStarEcho","_super","__extends","_this","apply","this","arguments","xingqiu","shanzi","wordIcon","roundIndex","maxRound","prototype","start","default","playMusic","BG","node","active","SpineUtils","playSpineAniByConfig","then","roundStart","curColor","func","changeWordCard","RoundStartAniConfig1","JSON","parse","stringify","Promise","resolve","reject","sent","startRecordAudio","CC_PREVIEW","afterRecordAni","afterPlayingRecordAni","succConfigAni","reportRoundCompleted","onGameEnd","onRecordResult","result","log","data","eventName","kit","manager","resources","loadRes","ResourceType","Normal","SpriteFrame","err","spf","spriteFrame","onDestroy","__decorate","sp","Skeleton","Sprite"],"mappings":"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","sourcesContent":["import { AnimationConfig } from \"../../../common/structure/CompInterface\";\n\nexport enum StarAniName {\n    Chuchang = '1.chuchang',\n    SayHello = '2.dazhaohu',\n    Idle1 = '3.daiji-zhayanjing',\n    Idle2 = '4.daiji-weixiao',\n    Speak = '5.shuohua',\n    ShanShanzi1 = '6.shanshanzi 1',\n    ShanShanzi2 = '6.shanshanzi 2',\n    SuccAni0 = '7.zhuanshanzi',\n    SuccAni1 = '8.rengshanzi',\n    SuccAni2 = '9.nachuhua',\n    SpeakWithLight1 = '10.faguang1',\n    SpeakWithLight2 = '10.faguang2',\n    SpeakWithLight3 = '10.faguang3',\n}\n\n\nexport enum StarAudioConfig {\n    BG = 'audios/BGM_guoshengri_01'\n}\n\nlet GameStartAniConfig: AnimationConfig[] = [\n    {\n        name: StarAniName.Chuchang,\n        loop: false,\n    },\n    {\n        name: StarAniName.SayHello,\n        loop: false,\n    },\n    {\n        name: StarAniName.Idle1,\n        loop: true,\n    }\n];\n\nlet RoundStartAniConfig: AnimationConfig[] = [\n    {\n        name: StarAniName.ShanShanzi1,\n        loop: false,\n    },\n    {\n        name: StarAniName.ShanShanzi2,\n        loop: false,\n    },\n    {\n        name: StarAniName.Idle1,\n        loop: true,\n    }\n];\n\nlet SpeakAniConfig: AnimationConfig[] = [\n    {\n        name: StarAniName.SpeakWithLight2,\n        loop: true,\n    },\n];\n\nlet IdleAniConfig: AnimationConfig[] = [\n    {\n        name: StarAniName.Idle2,\n        loop: true,\n    },\n];\n\nlet SuccAniConfig: AnimationConfig[] = [\n    {\n        name: StarAniName.Idle2,\n        loop: true,\n    },\n];\n\nlet ColorConfig = ['red', 'blue', 'yellow'];\n\nexport enum RecordTxt {\n    red = '红色',\n    blue = '蓝色',\n    yellow = '黄色',\n}\nexport { GameStartAniConfig, RoundStartAniConfig, SpeakAniConfig, ColorConfig, IdleAniConfig }","/**\n * 星球回声\n */\n\nimport ChapterGameComponent from \"../../../common/scripts/ChapterGameComponent\";\nimport { SpineUtils } from \"../../../common/utils/SpineUtils\";\nimport { kit } from \"../../../kit/kit\";\nimport { ResourceType } from \"../../../kit/manager/ResourcesManager\";\nimport AudioManager from \"../../../kit/system/audio/AudioManager\";\nimport { StarAudioConfig, GameStartAniConfig, RoundStartAniConfig, ColorConfig, SpeakAniConfig, RecordTxt, IdleAniConfig, StarAniName } from \"./RecordStarEchoConfig\";\n\nconst {ccclass, property} = cc._decorator;\n\n\nconst RECORDSTARECHO = 'recordStarEcho'\n@ccclass\nexport default class RecordStarEcho extends ChapterGameComponent {\n\n    @property(sp.Skeleton)\n    xingqiu: sp.Skeleton = null;\n\n    @property(sp.Skeleton)\n    shanzi: sp.Skeleton = null;\n\n    @property(cc.Sprite)\n    wordIcon:cc.Sprite = null;\n\n    roundIndex:number = 0;\n    maxRound:number = 3;\n\n    start() {\n        //背景\n        AudioManager.playMusic(RECORDSTARECHO, StarAudioConfig.BG);\n        this.xingqiu.node.active = true;\n        SpineUtils.playSpineAniByConfig(this.xingqiu, GameStartAniConfig).then(()=>{\n            this.roundStart()\n        });\n        SpineUtils.playSpineAniByConfig(this.shanzi, GameStartAniConfig).then();\n    }\n    \n    async roundStart(){\n        let curColor = ColorConfig[this.roundIndex];\n        RoundStartAniConfig[1].func = ()=>{\n            this.changeWordCard();\n        };\n        let RoundStartAniConfig1 = JSON.parse(JSON.stringify(RoundStartAniConfig));\n        RoundStartAniConfig1[1].func = null;\n        await new Promise<void>((resolve, reject) => {\n            SpineUtils.playSpineAniByConfig(this.xingqiu, RoundStartAniConfig).then(() => resolve());\n            SpineUtils.playSpineAniByConfig(this.shanzi, RoundStartAniConfig1).then();\n        });\n        // record\n        this.startRecordAudio(RecordTxt[curColor], RECORDSTARECHO, `audios/${curColor}`, `texture/icon_${curColor}`, 'follow');\n        if (CC_PREVIEW) {\n            this.scheduleOnce(() => {\n                let result = { data: { success: false, eventName: \"StopRecordCb\" } }\n                this.onRecordResult(result);\n            }, 2);\n        }\n    }\n\n    afterRecordAni(){\n        SpineUtils.playSpineAniByConfig(this.xingqiu, SpeakAniConfig).then();\n        SpineUtils.playSpineAniByConfig(this.shanzi, SpeakAniConfig).then();\n        if (CC_PREVIEW) {\n            this.scheduleOnce(() => {\n                let result = { data: { success: false, eventName: \"AudioFinishPlaying\" } }\n                this.onRecordResult(result);\n            }, 2);\n        }\n    }\n\n    async afterPlayingRecordAni(){\n        await new Promise<void>((resolve, reject) => {\n            let succConfigAni = [\n                {\n                    name: StarAniName[`SuccAni${this.roundIndex}`],\n                    loop: false,\n                },\n                {\n                    name: StarAniName.Idle2,\n                    loop: true,\n                },\n            ]\n            SpineUtils.playSpineAniByConfig(this.xingqiu, succConfigAni).then(() => resolve());\n            SpineUtils.playSpineAniByConfig(this.shanzi, succConfigAni).then();\n        });\n        // 环节完成\n        this.reportRoundCompleted(this.roundIndex, true);\n\n        // 下一环节\n        this.roundIndex++;\n\n        if (this.roundIndex >= this.maxRound) {\n            this.onGameEnd(true);\n            SpineUtils.playSpineAniByConfig(this.xingqiu, IdleAniConfig).then();\n            SpineUtils.playSpineAniByConfig(this.shanzi, IdleAniConfig).then();\n            return\n        }\n        this.roundStart();\n    }\n\n    public onRecordResult(result) {\n        cc.log(` recordResult result.data: ${result.data}`);\n        if (result.data.eventName == 'StopRecordCb') { // 停止录音回调\n            this.afterRecordAni();\n        } else if (result.data.eventName == 'AudioFinishPlaying') {\n            this.afterPlayingRecordAni();\n        }\n    }\n\n    changeWordCard(){\n        kit.manager.resources.loadRes(RECORDSTARECHO, `texture/icon_${ColorConfig[this.roundIndex]}`, ResourceType.Normal, cc.SpriteFrame, (err:Error, spf:cc.SpriteFrame)=>{\n            this.wordIcon.spriteFrame = spf;\n        });\n    }\n\n    onDestroy(){\n\n    }\n}\n"],"file":"index.js"}