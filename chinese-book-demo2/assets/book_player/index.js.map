{"version":3,"sources":["assets/bundles/book_player/src/PBBottomArea.ts","assets/bundles/book_player/src/PBPageContainer.ts","assets/bundles/book_player/src/PBPage.ts","assets/bundles/book_player/src/PBText.ts","assets/bundles/book_player/src/PBTrumpet.ts","assets/bundles/book_player/src/PictureBookPlayer.ts","assets/bundles/book_player/verlet/page-effect-assembler-base2.ts","assets/bundles/book_player/verlet/verlet-assembler2.ts","assets/bundles/book_player/verlet/verlet-render2.ts"],"names":["PBText_1","require","PBTrumpet_1","PictureBookPlayer_1","_a","cc","_decorator","ccclass","property","PBBottomArea","_super","__extends","_this","apply","this","arguments","trumpet","text","page_num","prototype","onTrumpetClicked","console","log","page","default","instance","currPage","voice","playVoice","onLoad","string","start","__decorate","type","displayName","RichText","Component","exports","AudioManager_1","verlet_render2_1","PBPage_1","PBPageContainer","pages","Map","uniqMap","prefabs","currPageIndex","leftHalf","rightHalf","leftHalf2","rightHalf2","verlet","page_material","turningLock","PBPageContainer_1","node","group","find","getComponent","onEnable","leftNode","Sprite","is3DNode","anchorX","width","height","x","y","rightNode","leftNode2","rightNode2","addVerlet","page1","page2","initAngle","isNext","Promise","resolve","active","zIndex","addComponent","setMaterial","_resetAssembler","updateAngle","setTextures","rightSpf","getTexture","leftSpf","removeVerlet","removeComponent","addPrefab","prefab","index","isValid","set","instantiate","eduPage","page_count","pageNum","turn_mode","PageModeEnum","_turn_mode","addPage","error","has","addChild","Object","defineProperty","get","onCaptured","toNextPage","__awaiter","nextPage","capture","sent","stopAllSounds","Camera","main","ortho","spriteFrame","eulerAngles","Vec3","ZERO","tween","delay","call","to","_angle","v3","TURN_DURATION","easing","toPrevPage","prevPage","unloadPrev","name","getPrefabName","destroy","assetManager","releaseAsset","delete","book_bundle","release","Prefab","unloadNext","forward","playEffect","loadNext","updatePageNum","backward","loadPrev","warn","loadPage","Enum","2d","3d","Material","PBPage","image","renderTexture","music","sound","soundLoop","soundMap","sleep","seconds","scheduleOnce","findImage","root","img","i","children","length","element","fixBg","onPageLoaded","audioEngine","playMusic","frameSize","view","getFrameSize","designResolution","Canvas","designSize","size","frameAspectRatio","screenSize","__assign","ratio","setLeftRight","left","right","visibleRect","Node","parent","camera","backgroundColor","Color","TRANSPARENT","clearFlags","ClearFlags","DEPTH","STENCIL","COLOR","cullingMask","rect","RenderTexture","gl","game","fmt","STENCIL_INDEX8","initWithSize","targetTexture","render","arr","Uint8Array","readPixels","texture","Texture2D","setFlipY","initWithData","sp","SpriteFrame","arr2","texture2","sp2","getSound","getVoice","clip","single","loop","duration","nativeUrl","id_1","stopEffect","id","bottomArea","play","stop","playSound","onDestroy","stopMusic","PBText","PBTrumpet","anim","Animation","bundleUtils_1","PBBottomArea_1","BaseChapterComponent_1","kit_1","PictureBookPlayer","left_slot","right_slot","bottom_slot","page_slot","left_arrow","right_arrow","book_bundle_name","playMode","PLAY_MODE_AUTO","mode_btn","autoturnpage","autoturnpage_after_voice","needAutoTurnPage","restTime","setText","txt","loadBook","bundleName","bookBundleName","loadBundle","then","bundle","loadFirstPage","kit","manager","Event","emit","consts","LIFE_CYCLE_READY","on","LIFE_CYCLE_PARAMS","onParams","Button","off","data","params","pageTimer","update","dt","onRightArrowClicked","onPageUnLoaded","reject","prefabName","str","load","onLeftArrowClicked","b","onModeChanged","label","Label","PLAY_MODE_MANAUL","PageEffectAssemblerBase","verticesCount","indicesCount","floatsPerVert","colorOffset","renderData","getBuffer","renderer","_handle","getVfmt","updateColor","comp","color","uintVerts","uintVDatas","_val","l","updateIsFront","dataOffset","verts","vDatas","n","isFirstVert","firstVertX","secondVertX","isFront","initData","RenderData","init","createFlexData","indices","iDatas","count","idx","vertextID","fillBuffers","vData","iData","buffer","offsetInfo","request","vertexOffset","byteOffset","vbuf","_vData","subarray","ibuf","_iData","indiceOffset","vertexId","Assembler","page_effect_assembler_base2_1","gfx","vfmtPosUvColorFront","VertexFormat","ATTR_POSITION","ATTR_TYPE_FLOAT32","num","ATTR_UV0","ATTR_COLOR","ATTR_TYPE_UINT8","normalize","VerletAssembler","segmentCount","pointsCount","updateRenderData","pointList","getPointList","pointNum","posX","posY","anchorY","gapU","lastU","nextU","dstOffset","lastPoint","nextPoint","verlet_assembler2_1","PagePoint","oldPos","newPos","v2","VerletRender2","constraintTimes","damping","gravity","_initedMaterial","_pointList","pointListShadow","initPointList","assembler","texture1","material","getMaterial","define","setProperty","angle","forEach","pp","push","simulate","applyConstraint","draw","point","velocity","sub","mul","Math","max","add","_updateEndPos","endPos","tailPoint","Vec2","_getEndPos","rad","PI","per","endPosX","pow","endPosY","normalDistance","t","firstPoint","secondPoint","delatPos","distance","mag","fixDirection","fixDirection2","negate","fixLen","abs","fixVector","addSelf","fixHalfVector1","fixHalfVector2","RenderComponent"],"mappings":"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","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport PBText from \"./PBText\";\nimport PBTrumpet from \"./PBTrumpet\";\nimport PictureBookPlayer from \"./PictureBookPlayer\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PBBottomArea extends cc.Component {\n\n    @property({ type: PBTrumpet, displayName: '小喇叭' })\n    trumpet: PBTrumpet = null\n\n    @property({ type: PBText, displayName: '文本' })\n    text: PBText = null\n\n    @property({ type: cc.RichText, displayName: '页码' })\n    page_num: cc.RichText = null\n\n    onTrumpetClicked() {\n        console.log('on pbbottomarea >>>>>>>>>>>>')\n        let page = PictureBookPlayer.instance.page.currPage\n        if (page && page.voice) {\n            page.playVoice(0)\n        }\n    }\n\n    onLoad() {\n        this.text.text.string = ''\n    }\n    start() {\n\n    }\n\n    // update (dt) {}\n}\n","// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport AudioManager from \"../../../kit/system/audio/AudioManager\";\nimport VerletRender2 from \"../verlet/verlet-render2\";\nimport PBPage from \"./PBPage\";\nimport PictureBookPlayer from \"./PictureBookPlayer\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PBPageContainer extends cc.Component {\n\n    pages = new Map<number, PBPage>()\n    uniqMap = new Map<number, boolean>()\n    prefabs = new Map<number, cc.Prefab>()\n\n    currPageIndex = 0\n\n    leftHalf: cc.Sprite = null\n    rightHalf: cc.Sprite = null\n\n    leftHalf2: cc.Sprite = null\n    rightHalf2: cc.Sprite = null\n\n    static instance: PBPageContainer = null\n    verlet: VerletRender2 = null\n\n    @property({ type: cc.Material, displayName: '翻页' })\n    page_material: cc.Material = null\n\n    // @property({ type: cc.Material, displayName: '翻页' })\n    // page_material:cc.Material = null\n\n    onLoad() {\n        PBPageContainer.instance = this\n        this.node.group = 'bookplayer'\n        this.verlet = cc.find('verlet', this.node).getComponent(VerletRender2)\n    }\n\n    onEnable() {\n        let leftNode = cc.find('left1', this.node)\n        this.leftHalf = leftNode.getComponent(cc.Sprite)\n        leftNode.is3DNode = false\n        leftNode.anchorX = 1\n        leftNode.width = this.node.width / 2\n        leftNode.height = this.node.height\n        leftNode.x = 0\n        leftNode.y = 0\n\n        let rightNode = cc.find('right1', this.node)\n        this.rightHalf = rightNode.getComponent(cc.Sprite)\n        rightNode.is3DNode = true\n        rightNode.anchorX = 0\n        rightNode.width = this.node.width / 2\n        rightNode.height = this.node.height\n        rightNode.x = 0\n        rightNode.y = 0\n\n        let leftNode2 = cc.find('left2', this.node)\n        this.leftHalf2 = leftNode2.getComponent(cc.Sprite)\n        leftNode2.is3DNode = true\n        leftNode2.anchorX = 1\n        leftNode2.width = this.node.width / 2\n        leftNode2.height = this.node.height\n        leftNode2.x = 0\n        leftNode2.y = 0\n\n        let rightNode2 = cc.find('right2', this.node)\n        this.rightHalf2 = rightNode2.getComponent(cc.Sprite)\n        rightNode2.is3DNode = true\n        rightNode2.anchorX = 0\n        rightNode2.width = this.node.width / 2\n        rightNode2.height = this.node.height\n        rightNode2.x = 0\n        rightNode2.y = 0\n    }\n    /**\n     * 添加verlet翻页效果节点\n     * @param page1 \n     * @param page2 \n     */\n    async addVerlet(page1: PBPage, page2: PBPage, initAngle: number, isNext: boolean) {\n        return new Promise<void>(resolve => {\n            let node = this.verlet.node\n            node.active = true\n            node.zIndex = 10000\n            node.width = this.node.width / 2\n            node.height = this.node.height\n            node.anchorX = 0\n            node.x = 0\n            node.y = 0\n            this.verlet = node.addComponent(VerletRender2)\n            this.verlet.setMaterial(0, this.page_material)\n            this.verlet._resetAssembler()\n            this.verlet.updateAngle(initAngle)\n            this.verlet.setTextures(page1.rightSpf.getTexture(), page2.leftSpf.getTexture())\n            resolve()\n        })\n    }\n\n    removeVerlet() {\n        this.verlet.node.active = false\n        this.verlet.node.removeComponent(VerletRender2)\n        // this.verlet.node.destroy()\n    }\n\n    start() {\n\n\n    }\n\n    static PageModeEnum = cc.Enum({ 'verlet': 0, '2d': 1, '3d': 2 })\n\n    async addPrefab(prefab: cc.Prefab, index: number) {\n        if (cc.isValid(prefab)) {\n            this.prefabs.set(index, prefab)\n            // if (this.prefabs.length == 1) {\n            let page = cc.instantiate(prefab).addComponent(PBPage)\n            page.index = index\n            if (index == 0) {//首页\n                //读取页数\n                let eduPage = page.node.getComponent('EduPage') as EduPage\n                PictureBookPlayer.page_count = eduPage.pageNum\n                PictureBookPlayer.turn_mode = PBPageContainer.PageModeEnum[eduPage._turn_mode] //eduPage.turnModeName\n            }\n            this.addPage(page)\n            // if (index == 0) {\n            //     this.loadNext()\n            // }\n        } else {\n            console.error('prefab is invalid!')\n        }\n\n        // }\n    }\n\n    addPage(page: PBPage) {\n        if (this.uniqMap.has(page.index)) {\n            return\n        }\n        this.uniqMap.set(page.index, true)\n        page.node.zIndex = -page.index * 10\n        this.node.addChild(page.node)\n        this.pages.set(page.index, page)\n    }\n\n    get currPage() {\n        return this.pages.get(this.currPageIndex)\n    }\n\n    get nextPage() {\n        if (this.currPageIndex + 1 < PictureBookPlayer.page_count) {\n            return this.pages.get(this.currPageIndex + 1)\n        }\n        return null\n    }\n\n    get prevPage() {\n        if (this.currPageIndex - 1 >= 0) {\n            return this.pages.get(this.currPageIndex - 1)\n        }\n        return null\n    }\n\n    onCaptured(page: PBPage) {\n        // if (page.index == this.currPageIndex) {\n        //     this.leftHalf.spriteFrame = page.leftSpf\n        //     this.rightHalf.spriteFrame = page.rightSpf\n        //     //test\n        //     this.leftHalf.node.active = true\n        //     this.rightHalf.node.active = false\n        // } else {\n        //     this.leftHalf2.spriteFrame = page.leftSpf\n        //     this.rightHalf2.spriteFrame = page.rightSpf\n        //     this.leftHalf2.node.active = false\n        //     this.rightHalf2.node.active = true\n        // }\n    }\n\n    private turningLock = false\n    static TURN_DURATION = 0.8\n\n    //下一页\n    async toNextPage() {\n        return new Promise<void>(async resolve => {\n            let nextPage = this.nextPage\n            if (nextPage == null) {\n                console.log('nextPage is null2>>>')\n                resolve()\n                return\n            }\n\n            let currPage = this.currPage\n\n            await currPage.capture()\n\n            // PictureBookPlayer.instance.config.turn_mode = '3d'\n            currPage.stopAllSounds()\n            if (PictureBookPlayer.turn_mode == '3d') {\n                cc.Camera.main.ortho = false\n            } else if (PictureBookPlayer.turn_mode == 'verlet') {\n                this.leftHalf.node.active = true\n                this.leftHalf.spriteFrame = currPage.leftSpf\n                this.rightHalf.node.active = false\n                this.rightHalf.spriteFrame = nextPage.rightSpf\n                this.leftHalf2.node.active = false\n                this.rightHalf2.node.active = false\n                this.leftHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.rightHalf.node.eulerAngles = cc.Vec3.ZERO\n                currPage.node.zIndex = 101\n                nextPage.node.zIndex = 100\n                this.leftHalf.node.zIndex = 101\n                this.rightHalf.node.zIndex = 102\n                await this.addVerlet(currPage, nextPage, 0, true)\n                cc.tween(this.verlet).delay(0.05).call(() => {\n                    currPage.node.zIndex = 0\n                    nextPage.node.zIndex = 100\n                    this.rightHalf.node.active = true\n                }).to(0.7, { _angle: 180 }).delay(0.5).call(() => {\n                    this.leftHalf.node.active = false\n                    this.rightHalf.node.active = false\n                    this.currPageIndex = nextPage.index\n                    this.removeVerlet()\n                    resolve()\n                }).start()\n            }\n\n            if (PictureBookPlayer.turn_mode != 'verlet') {\n                //设置图片内容\n                this.leftHalf.spriteFrame = currPage.leftSpf\n                this.rightHalf.spriteFrame = currPage.rightSpf\n                this.leftHalf2.spriteFrame = nextPage.leftSpf\n                this.rightHalf2.spriteFrame = nextPage.rightSpf\n\n                //设置姿态\n                this.leftHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.rightHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.leftHalf2.node.eulerAngles = cc.v3(0, 90, 0)\n                this.rightHalf2.node.eulerAngles = cc.Vec3.ZERO\n\n                //显隐\n                this.leftHalf.node.active = true\n                this.rightHalf.node.active = true\n                this.leftHalf2.node.active = false\n                this.rightHalf2.node.active = true\n\n                //设置遮挡\n                currPage.node.zIndex = 0\n                nextPage.node.zIndex = 100\n\n                this.leftHalf.node.zIndex = nextPage.node.zIndex + 1\n                this.rightHalf2.node.zIndex = nextPage.node.zIndex\n                this.rightHalf.node.zIndex = this.rightHalf2.node.zIndex + 1\n                this.leftHalf2.node.zIndex = this.leftHalf.node.zIndex + 1\n\n                //currPage\n                cc.tween(this.rightHalf.node)\n                    .to(PBPageContainer.TURN_DURATION / 2, { eulerAngles: cc.v3(0, -90, 0) }, { easing: 'sineIn' })\n                    .call(() => {\n                        this.rightHalf.node.active = false\n                    }).start()\n                //nextPage\n                cc.tween(this.leftHalf2.node)\n                    .delay(PBPageContainer.TURN_DURATION / 2)\n                    .call(() => {\n                        this.leftHalf2.node.active = true\n                    })\n                    .to(PBPageContainer.TURN_DURATION / 2, { eulerAngles: cc.v3(0, 0, 0) }, { easing: 'sineOut' })\n                    .call(() => {\n                        this.leftHalf2.node.active = false\n                        this.leftHalf.node.active = false\n                        this.rightHalf.node.active = false\n                        this.currPageIndex = nextPage.index\n                        if (PictureBookPlayer.turn_mode == '3d') {\n                            cc.Camera.main.ortho = true\n                        }\n                        resolve()\n                    }).start()\n            }\n\n            // PictureBookPlayer.instance.config.turn_mode = 'verlet'\n\n        })\n    }\n\n    //上一页\n    async toPrevPage() {\n        return new Promise<void>(async resolve => {\n            let prevPage = this.prevPage\n            if (prevPage == null) {\n                resolve()\n                return\n            }\n\n            let currPage = this.currPage\n\n            await currPage.capture()\n            currPage.stopAllSounds()\n            if (PictureBookPlayer.turn_mode == '3d') {\n                cc.Camera.main.ortho = false\n            } else if (PictureBookPlayer.turn_mode == 'verlet') {\n                this.leftHalf.node.active = false\n                this.leftHalf.spriteFrame = prevPage.leftSpf\n                this.rightHalf.node.active = true\n                this.rightHalf.spriteFrame = currPage.rightSpf\n                this.leftHalf2.node.active = false\n                this.rightHalf2.node.active = false\n                this.leftHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.rightHalf.node.eulerAngles = cc.Vec3.ZERO\n                currPage.node.zIndex = 101\n                prevPage.node.zIndex = 100\n                this.leftHalf.node.zIndex = 101\n                this.rightHalf.node.zIndex = 100\n                await this.addVerlet(prevPage, currPage, 180, false)\n                cc.tween(this.verlet).delay(0.05).call(() => {\n                    currPage.node.zIndex = 0\n                    prevPage.node.zIndex = 100\n                    this.leftHalf.node.active = true\n                }).to(0.7, { _angle: 0 }).delay(0.5).call(() => {\n                    this.leftHalf2.node.active = false\n                    this.rightHalf.node.active = false\n                    this.rightHalf2.node.active = false\n                    this.leftHalf.node.active = false\n                    this.currPageIndex = prevPage.index\n                    this.removeVerlet()\n                    resolve()\n                }).start()\n            }\n\n            if (PictureBookPlayer.turn_mode != 'verlet') {\n                //设置图片内容\n                this.leftHalf.spriteFrame = currPage.leftSpf\n                this.rightHalf.spriteFrame = currPage.rightSpf\n                this.leftHalf2.spriteFrame = prevPage.leftSpf\n                this.rightHalf2.spriteFrame = prevPage.rightSpf\n\n                //设置姿态\n                this.leftHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.rightHalf.node.eulerAngles = cc.Vec3.ZERO\n                this.leftHalf2.node.eulerAngles = cc.Vec3.ZERO\n                this.rightHalf2.node.eulerAngles = cc.v3(0, -90, 0)\n\n                //显隐\n                this.leftHalf.node.active = true\n                this.rightHalf.node.active = true\n                this.leftHalf2.node.active = true\n                this.rightHalf2.node.active = false\n\n                //设置遮挡\n                currPage.node.zIndex = 0\n                prevPage.node.zIndex = 100\n\n                this.leftHalf2.node.zIndex = prevPage.node.zIndex + 1\n                this.rightHalf.node.zIndex = this.leftHalf2.node.zIndex\n                this.rightHalf2.node.zIndex = this.rightHalf.node.zIndex + 1\n                this.leftHalf.node.zIndex = this.leftHalf2.node.zIndex + 1\n\n                //currPage\n                cc.tween(this.leftHalf.node)\n                    .to(PBPageContainer.TURN_DURATION / 2, { eulerAngles: cc.v3(0, 90, 0) }, { easing: 'sineIn' })\n                    .call(() => {\n                        this.leftHalf.node.active = false\n                    }).start()\n                //nextPage\n                cc.tween(this.rightHalf2.node)\n                    .delay(PBPageContainer.TURN_DURATION / 2)\n                    .call(() => {\n                        this.rightHalf2.node.active = true\n                    })\n                    .to(PBPageContainer.TURN_DURATION / 2, { eulerAngles: cc.v3(0, 0, 0) }, { easing: 'sineOut' })\n                    .call(() => {\n                        this.rightHalf2.node.active = false\n                        this.leftHalf2.node.active = false\n                        this.rightHalf.node.active = false\n                        this.currPageIndex = prevPage.index\n                        if (PictureBookPlayer.turn_mode == '3d') {\n                            cc.Camera.main.ortho = true\n                        }\n                        resolve()\n                    }).start()\n            }\n        })\n    }\n\n    unloadPrev() {\n        const index = this.currPageIndex - 2\n        if (index >= 0) {\n            let page = this.pages.get(index)\n            let name = PictureBookPlayer.instance.getPrefabName(index)\n            if (page) {\n                // console.log('destroy page node:' + page.index)\n                page.node.destroy()\n            }\n            let prefab = this.prefabs.get(index)\n            if (prefab) {\n                // console.log('destroy prefab:' + (index))\n                cc.assetManager.releaseAsset(prefab)\n                prefab.destroy()\n            }\n            this.uniqMap.delete(index)\n            this.pages.delete(index)\n            PictureBookPlayer.instance.book_bundle.release(name, cc.Prefab)\n        }\n    }\n\n    unloadNext() {\n        const index = this.currPageIndex + 2\n        if (index < PictureBookPlayer.page_count) {\n            let page = this.pages.get(index)\n            let name = PictureBookPlayer.instance.getPrefabName(index)\n            if (page) {\n                // console.log('destroy page node:' + page.index)\n                page.node.destroy()\n            }\n            let prefab = this.prefabs.get(index)\n            if (prefab) {\n                // console.log('destroy prefab:' + (index))\n                cc.assetManager.releaseAsset(prefab)\n                prefab.destroy()\n            }\n            this.uniqMap.delete(index)\n            this.pages.delete(index)\n            PictureBookPlayer.instance.book_bundle.release(name, cc.Prefab)\n        }\n    }\n\n    async forward() {\n        if (this.turningLock) {\n            return false\n        }\n\n        let nextPage = this.nextPage\n        if (nextPage == null) {\n            return false\n        }\n\n        this.turningLock = true\n        AudioManager.playEffect('book_player', 'sound/changepage')\n        await this.toNextPage()\n        if (this.currPageIndex < PictureBookPlayer.page_count - 1) {\n            await this.loadNext()\n        }\n        PictureBookPlayer.instance.updatePageNum()\n        this.unloadPrev()\n        this.turningLock = false\n        return true\n    }\n\n    async backward() {\n        if (this.turningLock) {\n            return\n        }\n        this.turningLock = true\n        AudioManager.playEffect('book_player', 'sound/changepage')\n        await this.toPrevPage()\n        if (this.currPageIndex > 0) {\n            await this.loadPrev()\n        }\n        PictureBookPlayer.instance.updatePageNum()\n        this.unloadNext()\n        this.turningLock = false\n    }\n\n    async loadNext() {\n        return new Promise<void>(async resolve => {\n            console.warn('load next:' + (this.currPageIndex + 1))\n            let prefab = await PictureBookPlayer.instance.loadPage(this.currPageIndex + 1)\n            if (prefab) {\n                this.addPrefab(prefab, this.currPageIndex + 1)\n            }\n            resolve()\n        })\n    }\n\n    async loadPrev() {\n        return new Promise<void>(async resolve => {\n            let prefab = await PictureBookPlayer.instance.loadPage(this.currPageIndex - 1)\n            if (prefab) {\n                this.addPrefab(prefab, this.currPageIndex - 1)\n            }\n            resolve()\n        })\n    }\n}\n","// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport PBPageContainer from \"./PBPageContainer\";\nimport PictureBookPlayer from \"./PictureBookPlayer\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PBPage extends cc.Component {\n\n    image: cc.Sprite = null //背景\n\n    renderTexture: cc.RenderTexture = null\n\n    index = 0\n\n    // leftHalf: cc.Sprite = null\n    // rightHalf: cc.Sprite = null\n\n    leftSpf: cc.SpriteFrame = null\n    rightSpf: cc.SpriteFrame = null\n\n    // config: PageConfig = null\n\n    music: cc.AudioClip = null\n    voice: cc.AudioClip = null\n    sound: cc.AudioClip = null\n    soundLoop = true\n    text = ''\n\n\n    onLoad() {\n        //加载资源\n        let eduPage = this.node.getComponent('EduPage') as EduPage\n        this.music = eduPage.music\n        this.voice = eduPage.voice\n        this.sound = eduPage.sound\n        this.soundLoop = eduPage.soundLoop\n        this.text = eduPage.text\n    }\n\n    async sleep(seconds: number) {\n        return new Promise<void>(resolve => {\n            this.scheduleOnce(() => {\n                resolve()\n            }, seconds)\n        });\n    }\n\n    /**\n     * 查找bg\n     */\n    static findImage(root: cc.Node) {\n        let img = root.getComponent(cc.Sprite)\n        if (img && (root.width >= 1334 && root.height >= 750)) {\n            return img\n        }\n        for (let i = 0; i < root.children.length; i++) {\n            const element = root.children[i];\n            img = this.findImage(element)\n            if (img) {\n                return img\n            }\n        }\n        return null\n    }\n\n    async start() {\n        this.image = cc.find('bg', this.node).getComponent(cc.Sprite)\n        // this.config = PictureBookPlayer.instance.getConfig(this.index)\n        let eduPage = this.node.getComponent('EduPage')\n        let music = eduPage.music\n        this.fixBg()\n        await this.capture()\n        PictureBookPlayer.instance.onPageLoaded(this)\n        if (this.music) {\n            // AudioManager.playMusic(PictureBookPlayer.instance.config.bundle, 'music/' + this.config.music)\n            cc.audioEngine.playMusic(this.music, true)\n        }\n    }\n\n    fixBg() {\n        let frameSize: cc.Size = cc.view.getFrameSize() // 屏幕尺寸\n        let designResolution: cc.Size = cc.Canvas.instance.designResolution\n        let designSize: cc.Size = cc.size(designResolution.width, designResolution.height)  // cc.Canvas.instance.designResolution\n        let frameAspectRatio: number = frameSize.width / frameSize.height\n        let screenSize: cc.Size = { ...designSize } as cc.Size\n\n        let ratio: number = this.image.node.width / this.image.node.height\n        if (ratio > frameAspectRatio) {\n            let width = this.image.node.width * screenSize.height / this.image.node.height\n            this.image.node.width = width\n            this.image.node.height = screenSize.height\n        } else {\n            let height = this.image.node.height * screenSize.width / this.image.node.width\n            this.image.node.width = screenSize.width\n            this.image.node.height = height\n        }\n        this.image.node.x = 0\n        this.image.node.y = 0\n    }\n\n    setLeftRight(left: cc.Sprite, right: cc.Sprite) {\n        // this.leftHalf = left\n        // this.rightHalf = right\n    }\n\n    async capture() {\n        return new Promise<void>(resolve => {\n            let width = cc.visibleRect.width\n            let height = cc.visibleRect.height\n            let node = new cc.Node('capture node')\n            node.parent = this.node\n            let camera = node.addComponent(cc.Camera)\n            camera.backgroundColor = cc.Color.TRANSPARENT\n            camera.clearFlags = cc.Camera.ClearFlags.DEPTH | cc.Camera.ClearFlags.STENCIL | cc.Camera.ClearFlags.COLOR\n            camera.cullingMask = 4\n\n            camera.rect = cc.rect(0, 0, 1, 1)\n            // camera.alignWithScreen = false\n            // camera.orthoSize = width / 2\n            let renderTexture = new cc.RenderTexture()\n            let gl = cc.game['_renderContext']\n            let fmt = gl.STENCIL_INDEX8//cc['gfx'].RB_FMT_S8 //gl.STENCIL_INDEX8\n            // renderTexture.initWithSize(width, height, gl.STENCIL_INDEX8);\n            renderTexture.initWithSize(width, height, fmt);\n            camera.targetTexture = renderTexture\n            camera.render()\n            //left half\n            let arr = new Uint8Array(width * height * 4)\n            renderTexture.readPixels(arr, 0, 0, width / 2, height)\n            let texture = new cc.Texture2D()\n            texture.setFlipY(true)\n            texture.initWithData(arr, fmt, width / 2, height)\n            let sp = new cc.SpriteFrame(texture)\n            this.leftSpf = sp\n\n            //right half\n            let arr2 = new Uint8Array(width * height * 4)\n            renderTexture.readPixels(arr2, width / 2, 0, width / 2, height)\n            let texture2 = new cc.Texture2D()\n            texture2.setFlipY(true)\n            texture2.initWithData(arr2, fmt, width / 2, height)\n            let sp2 = new cc.SpriteFrame(texture2)\n            this.rightSpf = sp2\n\n            renderTexture = null\n            arr = null\n            arr2 = null\n            node.destroy()\n            resolve()\n            PBPageContainer.instance.onCaptured(this)\n\n            // cc.find('snapshot1',PBPageContainer.instance.node.parent).getComponent(cc.Sprite).spriteFrame = sp\n            // cc.find('snapshot2',PBPageContainer.instance.node.parent).getComponent(cc.Sprite).spriteFrame = sp2\n\n        })\n    }\n\n    getSound(index) {\n        // if (!this.sound) {\n        //     return null\n        // }\n        // if (this.sound.length == 0) {\n        //     return null\n        // }\n        // if (index < 0 || index > this.config.sound.length - 1) {\n        //     return null\n        // }\n        // let sound = this.config.sound[index]\n        // let sound = this.sound\n        // let type = typeof sound\n        // if (type == 'object') {\n        //     return { name: 'sound/' + sound.name, loop: true }\n        // } else if (type == 'string') {\n        // return { name: 'sound/' + sound, loop: false }\n        // }\n\n        return this.sound\n    }\n\n    getVoice(index) {\n        // if (!this.config.voice) {\n        //     return null\n        // }\n        // if (this.config.voice.length == 0) {\n        //     return null\n        // }\n        // if (index < 0 || index > this.config.voice.length - 1) {\n        //     return null\n        // }\n        // let sound = this.config.voice[index]\n        // let type = typeof sound\n        // if (type == 'object') {\n        //     return { name: 'voice/' + sound.name, loop: true }\n        // } else if (type == 'string') {\n        //     return { name: 'voice/' + sound, loop: false }\n        // }\n        return this.voice\n    }\n\n    soundMap: Map<string, number> = new Map<string, number>()\n\n    async playEffect(clip: cc.AudioClip, single: boolean, loop: boolean) {\n        return new Promise<void>(resolve => {\n            let duration = clip.duration\n            if (single) {\n                if (this.soundMap.has(clip.nativeUrl)) {\n                    let id = this.soundMap.get(clip.nativeUrl)\n                    cc.audioEngine.stopEffect(id)\n                }\n            }\n            let id = cc.audioEngine.playEffect(clip, loop)\n            this.soundMap.set(clip.nativeUrl, id)\n            this.scheduleOnce(() => {\n                if (this.soundMap.has(clip.nativeUrl)) {\n                    this.soundMap.delete(clip.nativeUrl)\n                }\n                console.log('sound play over' + clip.nativeUrl)\n                resolve()\n            }, duration)\n        })\n    }\n\n    async playVoice(index: number) {\n        // AudioManager.stopEffect()\n        let sound = this.getVoice(index)\n        if (sound) {\n            PictureBookPlayer.instance.bottomArea.trumpet.play()\n            // await AudioManager.playEffectByName(PictureBookPlayer.instance.config.bundle, sound.name, true, sound.loop)\n            await this.playEffect(sound, true, false)\n            PictureBookPlayer.instance.bottomArea.trumpet.stop()\n        }\n    }\n\n    async playSound(index: number) {\n        // AudioManager.stopEffect()\n        let sound = this.getSound(index)\n        if (sound) {\n            // await AudioManager.playEffectByName(PictureBookPlayer.instance.config.bundle, sound.name, true, sound.loop)\n            await this.playEffect(sound, true, this.soundLoop)\n        }\n    }\n    // update (dt) {}\n\n    onDestroy() {\n        console.log('destroy page: ' + this.index)\n        if (this.leftSpf) {\n            this.leftSpf.destroy()\n            this.leftSpf = null\n        }\n\n        if (this.rightSpf) {\n            this.rightSpf.destroy()\n            this.rightSpf = null\n        }\n\n        // if (this.config.voice) {\n        //     this.config.voice.forEach((sound) => {\n        //         let type = typeof sound\n        //         let name = ''\n        //         if (type == 'object') {\n        //             name = sound.name\n        //         } else if (type == 'string') {\n        //             name = sound\n        //         }\n        //         AudioManager.destroyAudio(PictureBookPlayer.instance.config.bundle, 'voice/' + name)\n        //     })\n        // }\n\n        // if (this.config.sound) {\n        //     this.config.sound.forEach((sound) => {\n        //         let type = typeof sound\n        //         let name = ''\n        //         if (type == 'object') {\n        //             name = sound.name\n        //         } else if (type == 'string') {\n        //             name = sound\n        //         }\n        //         AudioManager.destroyAudio(PictureBookPlayer.instance.config.bundle, 'sound/' + name)\n        //     })\n        // }\n\n        // if (this.config.music) {\n        //     AudioManager.destroyAudio(PictureBookPlayer.instance.config.bundle, 'music/' + this.config.music)\n        // }\n\n    }\n\n\n    stopAllSounds() {\n        // if (this.config.voice) {\n        //     this.config.voice.forEach((sound) => {\n        //         let type = typeof sound\n        //         let name = ''\n        //         let isloop = false\n        //         if (type == 'object') {\n        //             name = 'voice/' + sound.name\n        //             isloop = sound.loop\n        //         } else if (type == 'string') {\n        //             name = 'voice/' + sound\n        //         }\n        //         if (!isloop) {\n        //             AudioManager.stopEffectByName(name)\n        //         } else {\n        //             AudioManager.stopLoopEffect(PictureBookPlayer.instance.config.bundle, name)\n        //         }\n        //     })\n        // }\n\n        // if (this.config.sound) {\n        //     this.config.sound.forEach((sound) => {\n        //         let type = typeof sound\n        //         let name = ''\n        //         let isloop = false\n        //         if (type == 'object') {\n        //             name = 'sound/' + sound.name\n        //             isloop = sound.loop\n        //         } else if (type == 'string') {\n        //             name = 'sound/' + sound\n        //         }\n        //         if (!isloop) {\n        //             AudioManager.stopEffectByName(name)\n        //         } else {\n        //             AudioManager.stopLoopEffect(PictureBookPlayer.instance.config.bundle, name)\n        //         }\n        //     })\n        // }\n\n        // if (this.config.music) {\n        //     AudioManager.stopMusic()\n        // }\n\n        if (this.sound) {\n            let clip = this.sound\n            if (this.soundMap.has(clip.nativeUrl)) {\n                let id = this.soundMap.get(clip.nativeUrl)\n                cc.audioEngine.stopEffect(id)\n            }\n        }\n\n        if (this.voice) {\n            let clip = this.voice\n            if (this.soundMap.has(clip.nativeUrl)) {\n                let id = this.soundMap.get(clip.nativeUrl)\n                cc.audioEngine.stopEffect(id)\n            }\n        }\n        if (this.music) {\n            cc.audioEngine.stopMusic()\n        }\n    }\n}\n","// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class PBText extends cc.Component {\n\n    \n    @property({ type: cc.RichText, displayName: '文本' })\n    text: cc.RichText = null\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {}\n\n    start () {\n\n    }\n\n    // update (dt) {}\n}\n","// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst { ccclass, property } = cc._decorator;\n/**\n * 绘本小喇叭\n */\n@ccclass\nexport default class PBTrumpet extends cc.Component {\n\n    anim: cc.Animation = null\n    onLoad() {\n        this.anim = cc.find('icon', this.node).getComponent(cc.Animation)\n    }\n\n    play() {\n        this.anim.play('playing')\n    }\n\n    stop() {\n        this.anim.play('pausing')\n    }\n\n    start() {\n\n    }\n\n    // update (dt) {}\n}\n","// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport AudioManager from \"../../../kit/system/audio/AudioManager\";\nimport { loadBundle } from \"../../../kit/utils/bundleUtils\";\nimport PBBottomArea from \"./PBBottomArea\";\nimport PBPage from \"./PBPage\";\nimport PBPageContainer from \"./PBPageContainer\";\nimport BaseChapterComponent from \"../../../common/scripts/BaseChapterComponent\";\nimport { kit } from \"../../../kit/kit\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PictureBookPlayer extends BaseChapterComponent {\n    left_slot: cc.Node = null\n    right_slot: cc.Node = null\n    bottom_slot: cc.Node = null\n    page_slot: cc.Node = null\n    book_bundle: cc.AssetManager.Bundle = null\n\n    bottomArea: PBBottomArea = null\n\n    left_arrow: cc.Node = null\n    right_arrow: cc.Node = null\n    // bottom: PBBottomArea = null\n\n    private book_bundle_name = ''\n\n    page: PBPageContainer = null\n\n    static instance: PictureBookPlayer = null\n    static turn_mode = 'verlet'\n    // config: BookConfig = null\n\n    static PLAY_MODE_AUTO = 0\n    static PLAY_MODE_MANAUL = 1\n    playMode = PictureBookPlayer.PLAY_MODE_AUTO //0自动 1手动\n\n    mode_btn: cc.Button = null\n\n    // getConfig(index: number) {\n    //     return this.config.pages[`${index + 1}`] as PageConfig\n    // }\n\n    // get currConfig() {\n    //     return this.getConfig(this.page.currPageIndex)\n    // }\n\n    setText(txt: string) {\n        this.bottomArea.text.text.string = txt\n    }\n\n    set bookBundleName(name) {\n        this.book_bundle_name = name\n    }\n\n    async loadBook(bundleName: string) {\n        this.bookBundleName = bundleName\n        return new Promise<void>(resolve => {\n            loadBundle(this.book_bundle_name).then(async (bundle: cc.AssetManager.Bundle) => {\n                this.book_bundle = bundle\n                // //加载UI\n                // this.book_bundle.load('custom/left_arrow', cc.Prefab, (error: Error, prefab: cc.Prefab) => {\n                //     if (error) {\n                        // this.left_arrow.active = true\n                //         return\n                //     }\n                //     let left_arrow = cc.instantiate(prefab)\n                //     this.left_slot.addChild(left_arrow)\n                // })\n                // this.book_bundle.load('custom/right_arrow', cc.Prefab, (error: Error, prefab: cc.Prefab) => {\n                //     if (error) {\n                        // this.right_arrow.active = true\n                //         return\n                //     }\n                //     let right_arrow = cc.instantiate(prefab)\n                //     this.right_slot.addChild(right_arrow)\n                // })\n\n                // this.book_bundle.load('custom/bottom_area', cc.Prefab, (error: Error, prefab: cc.Prefab) => {\n                //     if (error) {\n                        // this.bottomArea.node.active = true\n                //         return\n                //     }\n                //     let bottom_area = cc.instantiate(prefab).getComponent(PBBottomArea)\n                //     this.bottomArea = bottom_area\n                //     this.node.addChild(bottom_area.node)\n                // })\n\n                // this.book_bundle.load('setting', cc.JsonAsset, async (error: Error, txt: cc.JsonAsset) => {\n                //     if (error) {\n                //         console.log(error)\n                //         return\n                //     }\n                //     this.config = txt.json\n                //     await this.loadAllPages()\n                //     this.updatePageNum()\n                //     kit.manager.Event.emit(kit.consts.Event.LIFE_CYCLE_READY)\n                //     resolve()\n                // })\n                await this.loadFirstPage()\n                this.updatePageNum()\n                kit.manager.Event.emit(kit.consts.Event.LIFE_CYCLE_READY)\n            })\n        })\n    }\n\n    onLoad() {\n        PictureBookPlayer.instance = this\n        this.left_slot = cc.find('left_slot', this.node)\n        this.right_slot = cc.find('right_slot', this.node)\n        this.bottom_slot = cc.find('bottom_slot', this.node)\n        this.left_arrow = cc.find('left_arrow', this.left_slot)\n        this.left_arrow.active = true\n        this.right_arrow = cc.find('right_arrow', this.right_slot)\n        this.right_arrow.active = true\n        this.bottomArea = cc.find('bottom_area', this.bottom_slot).getComponent(PBBottomArea)\n        this.bottomArea.node.active = true\n        this.page_slot = cc.find('page_slot', this.node)\n        this.page = cc.find('page', this.page_slot).getComponent(PBPageContainer)\n        // let mc = cc.Camera.main\n        // mc.ortho = false\n        // mc.zoomRatio = 1\n        // mc.alignWithScreen = false\n        // mc.farClip = 4096*2\n        // // this.node.z = -1000\n        // this.node.is3DNode = true\n        kit.manager.Event.on(kit.consts.Event.LIFE_CYCLE_PARAMS, this.onParams, this)\n        this.mode_btn = cc.find('mode_btn', this.node).getComponent(cc.Button)\n    }\n\n    onDestroy() {\n        kit.manager.Event.off(kit.consts.Event.LIFE_CYCLE_PARAMS, this.onParams, this)\n    }\n\n    onParams(data) {\n        this.params = data.data\n        this.loadBook(this.params.bundle)\n    }\n\n    async onPageLoaded(page: PBPage) {\n        if (page.index == this.page.currPageIndex) {\n            if (page.text && page.text.length > 0) {\n                PictureBookPlayer.instance.setText(page.text)\n            }\n            if (page.sound) {\n                page.playSound(0)\n            }\n            this.pageTimer(page)\n        }\n    }\n\n    autoturnpage = 10\n    autoturnpage_after_voice = 5\n\n    pageTimer(page: PBPage) {\n        this.needAutoTurnPage = false\n        // if (page.config.voice && page.config.voice.length > 0) {\n        if (page.voice) {\n            if (this.autoturnpage > 0) {\n                page.playVoice(0).then(() => {\n                    // console.log('voice ended:' + page.config.voice[0])\n                    if (this.playMode == PictureBookPlayer.PLAY_MODE_AUTO) {\n                        this.needAutoTurnPage = true\n                        this.restTime = this.autoturnpage_after_voice\n                    }\n                })\n            } else {\n                page.playVoice(0)\n            }\n        } else {\n            this.needAutoTurnPage = true\n            this.restTime = this.autoturnpage\n        }\n    }\n\n    // autoTurningMode = false\n    needAutoTurnPage = false\n    restTime = 0\n    update(dt: number) {\n        if (this.needAutoTurnPage) {\n            if (this.restTime > 0) {\n                this.restTime -= dt\n                if (this.restTime <= 0) {\n                    console.log('auto turn page >>>>>')\n                    this.onRightArrowClicked()\n                }\n            }\n        }\n    }\n\n    async sleep(seconds: number) {\n        return new Promise<void>(resolve => {\n            this.scheduleOnce(() => {\n                resolve()\n            }, seconds)\n        });\n    }\n\n    onPageUnLoaded(page: PBPage) {\n        if (page.index == this.page.currPageIndex) {\n            PictureBookPlayer.instance.setText('')\n            AudioManager.stopEffect()\n        }\n    }\n\n    static page_count = 0\n\n    updatePageNum() {\n        this.bottomArea.page_num.string = `${this.page.currPageIndex + 1}/${PictureBookPlayer.page_count}`\n    }\n\n    async loadFirstPage() {\n        // let index = 0\n        return new Promise<void>(async (resolve, reject) => {\n            let prefab: cc.Prefab = null\n            // while (true) {\n            try {\n                prefab = await this.loadPage(0)\n                if (prefab == null) {\n                    // break\n                }\n                // index++\n                await this.page.addPrefab(prefab, 0)\n                this.page.loadNext()\n            } catch (error) {\n                // break\n            }\n            // }\n            resolve()\n        })\n    }\n\n    getPrefabName(index) {\n        let prefabName = 'EduPage'\n        if (index == 0) {\n            return prefabName\n        }\n\n        if (index > 0) {\n            let str = `${index}`\n            if (str.length == 1) {\n                prefabName += ' - 00' + str\n            } else if (str.length == 2) {\n                prefabName += ' - 0' + str\n            } else {\n                prefabName += ' - ' + str\n            }\n        }\n        return prefabName\n    }\n\n    async loadPage(index: number) {\n        return new Promise<cc.Prefab>(resolve => {\n            let prefabName = this.getPrefabName(index)\n            this.book_bundle.load(prefabName, cc.Prefab, (error: Error, prefab: cc.Prefab) => {\n                if (error) {\n                    resolve(null)\n                }\n                resolve(prefab)\n            })\n        })\n    }\n\n    start() {\n    }\n\n    // update (dt) {}\n\n    async onLeftArrowClicked() {\n        if (this.page.currPageIndex == 0) {\n            return\n        }\n        this.needAutoTurnPage = false\n        this.restTime = 0\n        this.onPageUnLoaded(this.page.currPage)\n        await this.page.backward()\n        this.onPageLoaded(this.page.currPage)\n    }\n\n    async onRightArrowClicked() {\n        if (this.page.currPageIndex == PictureBookPlayer.page_count) {\n            return\n        }\n        this.needAutoTurnPage = false\n        this.restTime = 0\n        this.onPageUnLoaded(this.page.currPage)\n        let b = await this.page.forward()\n        if (b) {\n            this.onPageLoaded(this.page.currPage)\n        }\n    }\n\n    onModeChanged() {\n        let label = cc.find('Label', cc.find('Background', this.mode_btn.node)).getComponent(cc.Label)\n        if (this.playMode == PictureBookPlayer.PLAY_MODE_AUTO) {\n            this.playMode = PictureBookPlayer.PLAY_MODE_MANAUL\n            label.string = '手动'\n        } else {\n            this.playMode = PictureBookPlayer.PLAY_MODE_AUTO\n            label.string = '自动'\n            let page = this.page.currPage\n            this.pageTimer(page)\n        }\n    }\n}\n","\nexport default class PageEffectAssemblerBase extends cc.Assembler {\n    // 普通四边形的属性，根据实际的顶点格式、数量调整\n    protected verticesCount = 4;\n    protected indicesCount = 6;\n    protected floatsPerVert = 5;\n\n    protected colorOffset = 4;    \n    protected renderData: cc.RenderData = null;\n\n    get verticesFloats() {\n        return this.verticesCount * this.floatsPerVert;\n    }\n\n    getBuffer() {\n        //@ts-ignore\n        return cc.renderer._handle.getBuffer(\"mesh\", this.getVfmt());\n    }\n\n    getVfmt() {\n        // to be overwrite\n        return null;\n    }\n\n    updateColor(comp, color) {\n        let uintVerts = this.renderData.uintVDatas[0];\n        if (!uintVerts) return;\n        color = color != null ? color : comp.node.color._val;\n        let floatsPerVert = this.floatsPerVert;\n        let colorOffset = this.colorOffset;\n        for (let i = colorOffset, l = uintVerts.length; i < l; i += floatsPerVert) {\n            uintVerts[i] = color;\n        }\n    }\n\n    updateIsFront(comp, dataOffset) {\n        let verts = this.renderData.vDatas[0];\n        let index = 0;\n        let floatsPerVert = this.floatsPerVert;\n        for (let i = 0, n = this.verticesCount; i < n; ++i) {\n            index = i * floatsPerVert;\n            let isFirstVert = i % 2 === 0;\n            let firstVertX = isFirstVert ? verts[index] : verts[index - floatsPerVert];\n            let secondVertX = isFirstVert ? verts[index + floatsPerVert] : verts[index];\n            let isFront = firstVertX < secondVertX ? 1.0 : 0.0;\n            verts[index + dataOffset] = isFront;\n        }\n    }\n    \n    initData() {\n        //@ts-ignore\n        this.renderData = new cc.RenderData();\n        this.renderData.init(this);\n\n        let data = this.renderData;\n        // createFlexData支持创建指定格式的renderData\n        data.createFlexData(0, this.verticesCount, this.indicesCount, this.getVfmt());\n\n        // 顶点数固定的情况下索引不变化\n        let indices = data.iDatas[0];\n        let count = indices.length / 6;\n        for (let i = 0, idx = 0; i < count; i++) {\n            let vertextID = i * 4;\n            indices[idx++] = vertextID;\n            indices[idx++] = vertextID+1;\n            indices[idx++] = vertextID+2;\n            indices[idx++] = vertextID+1;\n            indices[idx++] = vertextID+3;\n            indices[idx++] = vertextID+2;\n        }\n    }\n\n    fillBuffers(comp, renderer) {\n        let renderData = this.renderData;\n        let vData = renderData.vDatas[0] as any;\n        let iData = renderData.iDatas[0];\n\n        let buffer = this.getBuffer();\n        let offsetInfo = buffer.request(this.verticesCount, this.indicesCount);\n\n        let vertexOffset = offsetInfo.byteOffset >> 2,\n            vbuf = buffer._vData;\n\n        if (vData.length + vertexOffset > vbuf.length) {\n            //@ts-egnore\n            vbuf.set(vData.subarray(0, vbuf.length - vertexOffset), vertexOffset);\n        } else {\n            vbuf.set(vData, vertexOffset);\n        }\n\n        let ibuf = buffer._iData,\n            indiceOffset = offsetInfo.indiceOffset,\n            vertexId = offsetInfo.vertexOffset;\n        for (let i = 0, l = iData.length; i < l; i++) {\n            ibuf[indiceOffset++] = vertexId + iData[i];\n        }\n    }\n}\n","import PageEffectAssemblerBase from \"./page-effect-assembler-base2\";\r\n\r\nconst gfx = cc.gfx\r\n\r\nlet vfmtPosUvColorFront = new gfx.VertexFormat([\r\n    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_COLOR, type: gfx.ATTR_TYPE_UINT8, num: 4, normalize: true },\r\n    { name: \"a_isFront\", type: gfx.ATTR_TYPE_FLOAT32, num: 1},\r\n]);\r\n\r\nexport default class VerletAssembler extends PageEffectAssemblerBase {\r\n\r\n    init(comp: cc.RenderComponent) {\r\n        super['init'](comp);\r\n\r\n        //@ts-ignore\r\n        let segmentCount = comp.pointsCount - 1;\r\n        this.verticesCount = 4 * segmentCount;\r\n        this.indicesCount = 6 * segmentCount;\r\n        this.floatsPerVert = 6;\r\n        \r\n        this.initData();\r\n    }\r\n\r\n    getVfmt() {\r\n        return vfmtPosUvColorFront;\r\n    }\r\n    \r\n    public updateRenderData (comp: any) {\r\n        if (comp) {\r\n            let pointList: cc.Vec2[] = comp.getPointList()\r\n            let pointNum: number = pointList.length\r\n            if (pointNum < 2) {\r\n                return\r\n            }\r\n\r\n            let node = comp.node\r\n            let height = node.height\r\n            let width = node.width\r\n            let posX = - width * node.anchorX\r\n            let posY = - height * node.anchorY\r\n\r\n            let gapU = 1 / (pointNum - 1)\r\n            let lastU = 0\r\n            let nextU = 0\r\n\r\n            let floatsPerVert = this.floatsPerVert;\r\n            let verts = this.renderData.vDatas[0];\r\n            // 写verts时的下标\r\n            let dstOffset = 0;\r\n            for (let i = 1; i < pointNum; i++) {\r\n                let lastPoint = pointList[i - 1]\r\n                let nextPoint = pointList[i]\r\n                nextU = lastU + gapU\r\n\r\n                // 顶点和质点一一对应\r\n                // 顶点数据写入verts\r\n                dstOffset = floatsPerVert * (i-1) * 4;\r\n                verts[dstOffset]     = posX + lastPoint.x;\r\n                verts[dstOffset + 1] = posY + lastPoint.y;\r\n                verts[dstOffset + 2] = lastU;\r\n                verts[dstOffset + 3] = 1;\r\n                dstOffset += floatsPerVert;\r\n\r\n                verts[dstOffset]     = posX + nextPoint.x;\r\n                verts[dstOffset + 1] = posY + nextPoint.y;\r\n                verts[dstOffset + 2] = nextU;\r\n                verts[dstOffset + 3] = 1;\r\n                dstOffset += floatsPerVert;\r\n\r\n                verts[dstOffset]     = posX + lastPoint.x;\r\n                verts[dstOffset + 1] = posY + height + lastPoint.y;\r\n                verts[dstOffset + 2] = lastU;\r\n                verts[dstOffset + 3] = 0;\r\n                dstOffset += floatsPerVert;\r\n\r\n                verts[dstOffset]     = posX + nextPoint.x;\r\n                verts[dstOffset + 1] = posY + height + nextPoint.y;\r\n                verts[dstOffset + 2] = nextU;\r\n                verts[dstOffset + 3] = 0;\r\n\r\n                lastU = nextU\r\n            }\r\n\r\n            this.updateColor(comp, null);\r\n            this.updateIsFront(comp, 5);\r\n        }\r\n    }\r\n}","import VerletAssembler from \"./verlet-assembler2\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nclass PagePoint {\r\n    public oldPos: cc.Vec2\r\n    public newPos: cc.Vec2\r\n\r\n    constructor(x: number, y: number) {\r\n        this.oldPos = this.newPos = cc.v2(x, y)\r\n    }\r\n}\r\n\r\n@ccclass\r\nexport default class VerletRender2 extends cc.RenderComponent {\r\n    // @property({type: [cc.Texture2D], displayName:\"纹理\"})\r\n    // public textureList: cc.Texture2D[] = []\r\n\r\n    // @property({displayName:\"每条边上的顶点数量\"})\r\n    public pointsCount: number = 10\r\n\r\n    // @property({displayName:\"纠正次数\"})\r\n    public constraintTimes: number = 50\r\n\r\n    // @property({displayName:\"速度衰减系数\"})\r\n    public damping: number = 0.7\r\n\r\n    // @property({displayName:\"重力\"})\r\n    public gravity: number = -0.2\r\n\r\n    protected _initedMaterial: boolean = false\r\n    private _pointList: PagePoint[] = []\r\n    _angle: number = 0\r\n    // onEnable() {\r\n    //     super.onEnable();\r\n    //     this.initPointList();\r\n    //     // this.draw();\r\n    // }\r\n\r\n    start() {\r\n        this.initPointList();\r\n        this.update();\r\n    }\r\n\r\n    public _resetAssembler() {\r\n        let assembler = this['_assembler'] = new VerletAssembler()\r\n        assembler.init(this)\r\n    }\r\n\r\n    setTextures(texture1: cc.Texture2D, texture2: cc.Texture2D) {\r\n        let material = this.getMaterial(0)\r\n        if (material) {\r\n            material.define('CC_USE_MODEL', 1);\r\n            material.setProperty('texture0', texture1);\r\n            material.setProperty('texture1', texture2);\r\n        }\r\n    }\r\n\r\n    public updateAngle(angle: number) {\r\n        this._angle = angle\r\n    }\r\n\r\n    private pointListShadow: cc.Vec2[] = []\r\n    public getPointList() {\r\n        let pointList = this.pointListShadow\r\n        // if (pointList.length == 0) {\r\n        //     for (let point of this._pointList) {\r\n        //         pointList.push(new cc.Vec2(point.newPos.x, point.newPos.y))\r\n        //     }\r\n        // } else {\r\n        this._pointList.forEach((pp, i) => {\r\n            pointList[i].x = pp.newPos.x\r\n            pointList[i].y = pp.newPos.y\r\n        })\r\n        // }\r\n        return pointList\r\n    }\r\n\r\n    // 初始化质点\r\n    public initPointList() {\r\n        for (let i = 0; i < this.pointsCount; ++i) {\r\n            let posX = i / (this.pointsCount - 1) * this.node.width\r\n            this._pointList.push(new PagePoint(posX, 0))\r\n            this.pointListShadow.push(cc.v2(this._pointList[i].newPos.x, this._pointList[i].newPos.y))\r\n        }\r\n    }\r\n\r\n    public update() {\r\n        this.simulate()\r\n        this.applyConstraint()\r\n        this.draw()\r\n    }\r\n\r\n    // 使用verlet积分更新位置\r\n    public simulate() {\r\n        let gravity = cc.v2(0, this.gravity)\r\n        for (let i = this.pointsCount - 1; i >= 1; i--) {\r\n            let point = this._pointList[i]\r\n            // 速度等于当前位置与上一个位置的差乘上衰减系数\r\n            let velocity: cc.Vec2 = point.newPos.sub(point.oldPos).mul(this.damping)\r\n            // 模拟一个水平放置的绳子，当y小于等于0时，将不再受重力影响\r\n            if (point.newPos.y <= 0) {\r\n                gravity.y = Math.max(0, gravity.y)\r\n            }\r\n            point.oldPos = point.newPos\r\n            point.newPos = point.newPos.add(velocity)\r\n            point.newPos = point.newPos.add(gravity)\r\n        }\r\n    }\r\n\r\n    private _updateEndPos(endPos: cc.Vec2) {\r\n        let tailPoint = this._pointList[this.pointsCount - 1]\r\n        tailPoint.newPos = new cc.Vec2(endPos.x, endPos.y)\r\n    }\r\n\r\n    private _getEndPos(): cc.Vec2 {\r\n        let endPos = new cc.Vec2(0, 0)\r\n        let width = this.node.width\r\n        let rad = this._angle * Math.PI / 180\r\n\r\n        // 与贝塞尔曲线使用相同的运动轨迹\r\n        let per = rad * 2 / Math.PI\r\n        if (this._angle <= 90) {\r\n            let endPosX = width * (1 - Math.pow(per, 3))\r\n            let endPosY = width * 1 / 4 * (1 - Math.pow(1 - per, 4))\r\n            endPos = new cc.Vec2(endPosX, endPosY)\r\n        } else {\r\n            per = per - 1\r\n            let endPosX = - width * (1 - Math.pow(1 - per, 3))\r\n            let endPosY = width * 1 / 4 * (1 - Math.pow(per, 4))\r\n            endPos = new cc.Vec2(endPosX, endPosY)\r\n        }\r\n\r\n\r\n        return endPos\r\n    }\r\n    // 约束纠正\r\n    public applyConstraint() {\r\n        // 两个质点之间的固定距离\r\n        let normalDistance = this.node.width / (this.pointsCount - 1)\r\n        let endPos = this._getEndPos()\r\n        for (let t = 0; t < this.constraintTimes; t++) {\r\n            this._updateEndPos(endPos)\r\n            //由最后一个质点开始依次纠正\r\n            for (let i = this.pointsCount - 1; i >= 1; i--) {\r\n                let firstPoint = this._pointList[i - 1]\r\n                let secondPoint = this._pointList[i]\r\n                let delatPos = secondPoint.newPos.sub(firstPoint.newPos)  //d\r\n                let distance = delatPos.mag()\r\n                let fixDirection: cc.Vec2 = null\r\n                let fixDirection2: cc.Vec2 = null\r\n                if (distance < normalDistance) {\r\n                    fixDirection = delatPos.normalize().negate()\r\n                    fixDirection2 = delatPos.normalize()\r\n                } else if (distance > normalDistance) {\r\n                    fixDirection = delatPos.normalize()\r\n                    fixDirection2 = delatPos.normalize().negate()\r\n                } else {\r\n                    continue\r\n                }\r\n\r\n                let fixLen = Math.abs(distance - normalDistance)\r\n                if (i == 1) {\r\n                    // 由于第一个质点是固定的，所以只对第二个质点做纠正\r\n                    let fixVector = fixDirection2.mul(fixLen)\r\n                    secondPoint.newPos.addSelf(fixVector)\r\n                } else {\r\n                    // 将两个质点之间的距离纠正为固定长度\r\n                    let fixHalfVector1 = fixDirection.mul(fixLen * 0.5)\r\n                    firstPoint.newPos.addSelf(fixHalfVector1)\r\n                    let fixHalfVector2 = fixDirection2.mul(fixLen * 0.5)\r\n                    secondPoint.newPos.addSelf(fixHalfVector2)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        this['setVertsDirty']()\r\n    }\r\n}"],"file":"index.js"}