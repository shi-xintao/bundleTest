window.__require=function t(i,e,n){function o(c,s){if(!e[c]){if(!i[c]){var r=c.split("/");if(r=r[r.length-1],!i[r]){var u="function"==typeof __require&&__require;if(!s&&u)return u(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var l=e[c]={exports:{}};i[c][0].call(l.exports,function(t){return o(i[c][1][t]||t)},l,l.exports,t,i,e,n)}return e[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<n.length;c++)o(n[c]);return o}({EatBeansConfig:[function(t,i,e){"use strict";cc._RF.push(i,"599ecwn7eJA4KQMi2OGq8+w","EatBeansConfig"),Object.defineProperty(e,"__esModule",{value:!0}),e.EATBEANS_SOUND_CONFIG=void 0,function(t){t.C="sound/C",t.D="sound/D",t.clickandlisten="sound/clickandlisten",t.SE_zimuchidou_01="sound/SE_zimuchidou_01",t.SE_zimuchidou_02="sound/SE_zimuchidou_02",t.SE_zimuchidou_03="sound/SE_zimuchidou_03",t.SE_zimuchidou_04="sound/SE_zimuchidou_04",t.SE_zimuchidou_05="sound/SE_zimuchidou_05",t.SE_zimuchidou_06="sound/SE_zimuchidou_06"}(e.EATBEANS_SOUND_CONFIG||(e.EATBEANS_SOUND_CONFIG={})),cc._RF.pop()},{}],EatBeans:[function(t,i,e){"use strict";cc._RF.push(i,"5b2f1FGXfVCI6iOhDZ6DIbv","EatBeans");var n,o=this&&this.__extends||(n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),a=this&&this.__assign||function(){return(a=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)},c=this&&this.__decorate||function(t,i,e,n){var o,a=arguments.length,c=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,i,e,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(a<3?o(c):a>3?o(i,e,c):o(i,e))||c);return a>3&&c&&Object.defineProperty(i,e,c),c},s=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))(function(o,a){function c(t){try{r(n.next(t))}catch(i){a(i)}}function s(t){try{r(n.throw(t))}catch(i){a(i)}}function r(t){var i;t.done?o(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(c,s)}r((n=n.apply(t,i||[])).next())})},r=this&&this.__generator||function(t,i){var e,n,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(i){return r([t,i])}}function r(a){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,n=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=i.call(t,c)}catch(s){a=[6,s],n=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0});var u=t("../../../kit/manager/ResourcesManager"),l=t("../../../kit/system/audio/AudioManager"),d=t("../../../kit/system/timer/TimerSystem"),h=t("../../common/notifierCenter"),p=t("../../common/Tigo"),m=t("./EatBeansConfig"),f=cc._decorator,_=f.ccclass,g=f.property,S=[[["day5_1_BigC_idle","day5_1_BigC_JZ"],["day5_1_C_small_idle","day5_1_C_small_JZ"]],[["day5_1_BigD_idle","day5_1_BigD_JZ"],["day5_1_D_small_idle","day5_1_D_small_JZ"]]],y=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.smallcCount=6,i.smalldCount=4,i.bigcCount=6,i.bigdCount=4,i.clickItemPrefab=null,i.zimuCArr=[],i.zimuDArr=[],i.rightNode=null,i.rectNode=null,i.posNodeArr=[],i.spCSpine=null,i.spDSpine=null,i.shadingBg=null,i.clickBtn=null,i.handSpine=null,i.itemContent=null,i.caidaiSpine=null,i.jinbiSpine=null,i.bg=null,i.curZimu="c",i.clickItems=[],i.bigZimuCount=0,i.smallZimuCount=0,i.hasGuidUser=!1,i.guildSoundTimer=null,i}return o(i,t),i.prototype.onLoad=function(){this.initUI(),this.initNative(),p.default.callAppToLoaded()},i.prototype.start=function(){var t=this;this.fixBg(),this.scheduleOnce(function(){t.showZimuSpine()},3)},i.prototype.fixBg=function(){var t=cc.winSize,i=cc.Canvas.instance.designResolution,e=cc.size(i.width,i.height),n=t.width/t.height,o=a({},e);if(this.bg.width/this.bg.height>n){var c=this.bg.width*o.height/this.bg.height;this.bg.width=c,this.bg.height=o.height}else{var s=t.width/e.width;this.bg.width=e.width*s,this.bg.height=e.height*s}this.bg.x=0,this.bg.y=0},i.prototype.addGuildSoundTimer=function(){var t=this;this.guildSoundTimer&&this.clearGuidHand(),this.guildSoundTimer=d.default.instance.doOnce(5e3,function(){cc.isValid(t.node)&&(t.handSpine.active=!0)},this)},i.prototype.clearGuidHand=function(){this.handSpine.active=!1,d.default.instance.clearTimer(this.guildSoundTimer),this.guildSoundTimer=null},i.prototype.initNative=function(){window.webframe={},window.webframe.Notify=new h.default,window.webframe.Notify.listen("callCocos_loaded",function(){console.log(" ===callCocos_loaded=== ")},this,!0)},i.prototype.initUI=function(){this.rightNode=cc.find("right_node",this.node),this.rectNode=cc.find("right_node/rect_node",this.node),this.shadingBg=cc.find("right_node/bg2",this.node),this.clickBtn=cc.find("right_node/button",this.node).getComponent(cc.Button);for(var t=1;t<5;t++){var i=cc.find("right_node/pos_"+t,this.node);this.posNodeArr.push(i)}this.itemContent=cc.find("right_node/item_content",this.node),this.spCSpine=cc.find("right_node/sprite_node/c",this.node).getComponent(sp.Skeleton),this.spDSpine=cc.find("right_node/sprite_node/d",this.node).getComponent(sp.Skeleton),this.handSpine=cc.find("right_node/shou",this.node),this.bg=cc.find("bg",this.node),this.caidaiSpine=cc.find("spineNode",this.node).getComponent(sp.Skeleton),this.jinbiSpine=cc.find("W4L2-SPINE-1",this.node).getComponent(sp.Skeleton),this.handSpine.zIndex=cc.macro.MAX_ZINDEX},i.prototype.showZimuSpine=function(){return s(this,void 0,void 0,function(){var t,i,e,n,o=this;return r(this,function(a){switch(a.label){case 0:return t="c"==this.curZimu?this.zimuCArr:this.zimuDArr,this.shadingBg.active=!0,cc.winSize.width,i=[130,-130],t.map(function(t,e){t.x=-i[e],t.scale=2,t.active=!0}),e="c"==this.curZimu?0:1,n=S[e],[4,this.playZimuStartAni(t[0],n[0][0],n[0][1])];case 1:return a.sent(),[4,this.playZimuStartAni(t[1],n[1][0],n[1][1])];case 2:return a.sent(),this.shadingBg.active=!1,[4,this.playZimuMoveAni()];case 3:return a.sent(),l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.clickandlisten),this.clickBtn.interactable=!0,this.smallZimuCount=0,this.bigZimuCount=0,this.hasGuidUser?(cc.tween(this.node).repeatForever(cc.tween(this.node).delay(1.8).call(function(){o.createClickItem().then(function(t){o.itemMoveAni(t)})})).start(),this.addGuildSoundTimer()):this.startCreateItem(),l.default.playLoopEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_06),[2]}})})},i.prototype.playZimuStartAni=function(t,i,e){var n=this;return new Promise(function(o){var a="c"==n.curZimu?m.EATBEANS_SOUND_CONFIG.C:m.EATBEANS_SOUND_CONFIG.D;l.default.playEffect("eatBeans",a,function(){var n=t.getChildByName("spine").getComponent(sp.Skeleton);n.curCount=0;var a=n.setAnimation(0,i,!1);n.addAnimation(0,e,!1),n.setTrackCompleteListener(a,function(){o()}),l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_05)})})},i.prototype.playZimuMoveAni=function(){var t=this;return new Promise(function(i){l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_04);var e="c"==t.curZimu?t.zimuCArr:t.zimuDArr;cc.tween(e[0]).to(.5,{x:t.spCSpine.node.x,y:-146,scale:1}).start(),cc.tween(e[1]).to(.5,{x:t.spCSpine.node.x,y:190,scale:1}).call(function(){i()}).start()})},i.prototype.startCreateItem=function(){var t=this;this.createClickItem("texture/icon_big_c5").then(function(i){cc.tween(i).to(4,{position:t.posNodeArr[1].position}).to(1.4,{position:t.rectNode.position}).call(function(){t.changeClickItemAniState(!0),t.node.pauseAllActions(),l.default.stopLoopEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_06),t.handSpine.active=!0,t.addGuildSoundTimer()}).start(),cc.tween(t.node).repeatForever(cc.tween(t.node).delay(1.8).call(function(){t.createClickItem().then(function(i){t.itemMoveAni(i)})})).start()})},i.prototype.randomClickItem=function(){var t="texture/icon_jimu",i=["big","big","small","small","daoju"];this.smallZimuCount>=3?i=["big","big","daoju"]:this.bigZimuCount>=3&&(i=["small","small","daoju"]);var e,n=this.getRandomNum(i.length)-1;if("big"==i[n]){var o="c"==this.curZimu?this.bigcCount:this.bigdCount;e=this.getRandomNum(o),t="texture/icon_big_"+this.curZimu+e}else"small"==i[n]?(o="c"==this.curZimu?this.smallcCount:this.smalldCount,e=this.getRandomNum(o),t="texture/icon_small_"+this.curZimu+e):t="texture/icon_daoju_"+(e=this.getRandomNum(2));return t},i.prototype.getRandomNum=function(t){return Math.floor(Math.random()*t+1)},i.prototype.createClickItem=function(t){return s(this,void 0,void 0,function(){var i,e,n;return r(this,function(o){switch(o.label){case 0:return i=cc.instantiate(this.clickItemPrefab),e=t||this.randomClickItem(),[4,this.loadItemSprite(e)];case 1:return n=o.sent(),i.getComponent(cc.Sprite).spriteFrame=n,i.parent=this.itemContent,i.position=this.posNodeArr[0].position,i.name=e.split("/")[1],"icon_daoju_1"==i.name&&(i.scale=.8),this.clickItems.push(i),[2,i]}})})},i.prototype.loadItemSprite=function(t){return new Promise(function(i){u.default.instance.loadRes("eatBeans",t,u.ResourceType.Normal,cc.SpriteFrame,function(t,e){i(e)})})},i.prototype.itemMoveAni=function(t){var i=this;cc.tween(t).to(4,{position:this.posNodeArr[1].position}).to(2.8,{position:this.posNodeArr[2].position}).to(4,{position:this.posNodeArr[3].position}).call(function(){i.removeClickItem(t),t.destroy()}).start()},i.prototype.onPickBtnClicked=function(){this.addGuildSoundTimer();for(var t=this.rectNode.getBoundingBox(),i=0;i<this.clickItems.length;i++){var e=this.clickItems[i];if(t.intersects(e.getBoundingBox())){this.dealClickedItem(e),this.dealSpriteAni(e.name);break}}this.hasGuidUser||(this.hasGuidUser=!0,this.handSpine.active=!1,this.changeClickItemAniState(!1),this.node.resumeAllActions(),l.default.playLoopEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_06))},i.prototype.dealClickedItem=function(t){var i="c"==this.curZimu?this.spCSpine:this.spDSpine;this.removeClickItem(t),cc.tween(t).to(.3,{position:i.node.position.add(cc.v3(0,60)),scale:0}).call(function(){t.destroy()}).start()},i.prototype.dealSpriteAni=function(t){var i,e=this,n="c"==this.curZimu?this.spCSpine:this.spDSpine,o="c"==this.curZimu?m.EATBEANS_SOUND_CONFIG.C:m.EATBEANS_SOUND_CONFIG.D;t.includes("daoju_2")?(n.setAnimation(0,"zha",!1),i="daoju_2",l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_02)):t.includes("daoju_1")?(n.setAnimation(0,"ganga",!1),i="daoju_1",l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_01)):t.includes("small")?(n.setAnimation(0,"chi",!1),i="small",this.smallZimuCount++,this.scheduleOnce(function(){e.dealZimuAni(i)},.5),l.default.playEffect("eatBeans",o)):t.includes("big")&&(n.setAnimation(0,"chi",!1),i="big",this.bigZimuCount++,this.scheduleOnce(function(){e.dealZimuAni(i)},.5),l.default.playEffect("eatBeans",o)),n.addAnimation(0,"idle",!0),this.checkComplete()},i.prototype.dealZimuAni=function(t){var i,e,n,o=this,a="c"==this.curZimu?this.zimuCArr:this.zimuDArr,c=[[["day5_1_BigC_1","day5_1_BigC_2","day5_1_BigC_3"],["day5_1_C_small_1","day5_1_C_small_2","day5_1_C_small_3"]],[["day5_1_BigD_1","day5_1_BigD_2","day5_1_BigD_3"],["day5_1_D_small_1","day5_1_D_small_2","day5_1_D_small_3"]]]["c"==this.curZimu?0:1];if("small"==t?(i=a[1],e=c[1][this.smallZimuCount-1],n=this.smallZimuCount):"big"==t&&(i=a[0],e=c[0][this.bigZimuCount-1],n=this.bigZimuCount),!(n>3)&&i){var s=i.getChildByName("shading");n<=3?(s.active=!0,cc.Tween.stopAllByTarget(s),cc.tween(s).delay(.5).call(function(){s.active=!1;var t=i.getChildByName("spine").getComponent(sp.Skeleton);if(e){var a=t.setAnimation(0,e,!1);3==n&&t.setTrackCompleteListener(a,function(){("c"==o.curZimu?o.spCSpine:o.spDSpine).setAnimation(0,"baoge",!1),t.addAnimation(0,"idle",!0),l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_03)})}}).start()):s.active=!1}},i.prototype.checkComplete=function(){var t=this;this.smallZimuCount>=3&&this.bigZimuCount>=3&&(this.clickBtn.interactable=!1,this.node.stopAllActions(),this.clearGuidHand(),this.scheduleOnce(function(){l.default.stopLoopEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_06),"c"==t.curZimu?(t.spCSpine.node.active=!1,t.spDSpine.node.active=!0,t.zimuCArr.map(function(t){return t.active=!1}),t.curZimu="d",t.showZimuSpine()):t.gameOverAni()},3))},i.prototype.gameOverAni=function(){cc.log("game over"),this.shadingBg.active=!0;var t=cc.winSize.width,i=[-100-t/6,100-t/6],e=S[0];this.zimuCArr.map(function(t,n){t.y=0==n?0:-27,t.x=i[n],t.scale=2,t.getChildByName("shading").active=!1,t.active=!0;var o=t.getChildByName("spine").getComponent(sp.Skeleton),a=e[n][1];console.log(" ====== aniName\uff1b ",a),o.setAnimation(0,a,!0)}),i=[t/6-100,t/6+100],e=S[1],this.zimuDArr.map(function(t,n){t.y=0==n?0:-27,t.x=i[n]+30,t.scale=2,t.getChildByName("shading").active=!1,t.active=!0;var o=t.getChildByName("spine").getComponent(sp.Skeleton),a=e[n][1];console.log(" ====== aniName\uff1b ",a),o.setAnimation(0,a,!0)}),this.gameOverSoundAndAni()},i.prototype.gameOverSoundAndAni=function(){return s(this,void 0,void 0,function(){var t,i=this;return r(this,function(e){switch(e.label){case 0:return[4,this.playZimuEndAni(this.zimuCArr,S[0],m.EATBEANS_SOUND_CONFIG.C)];case 1:return e.sent(),[4,this.playZimuEndAni(this.zimuDArr,S[1],m.EATBEANS_SOUND_CONFIG.D)];case 2:return e.sent(),this.caidaiSpine.node.active=!0,t=this.caidaiSpine.setAnimation(0,"caidai",!1),this.caidaiSpine.setTrackCompleteListener(t,function(){cc.log("\u6492\u82b1\u7ed3\u675f"),i.jinbiSpine.node.active=!0,i.jinbiSpine.setAnimation(0,"Animation",!0),i.scheduleOnce(function(){p.default.callAppToClose("replayOrNext",!0)},2)}),[2]}})})},i.prototype.playZimuEndAni=function(t,i,e){return new Promise(function(n){l.default.playEffect("eatBeans",e,function(){t.map(function(t,e){l.default.playEffect("eatBeans",m.EATBEANS_SOUND_CONFIG.SE_zimuchidou_05);var o=t.getChildByName("spine").getComponent(sp.Skeleton),a=o.setAnimation(0,i[e][0],!1);o.addAnimation(0,i[e][1],!1),o.setTrackCompleteListener(a,function(){n()})})})})},i.prototype.removeClickItem=function(t){var i=this.clickItems.indexOf(t);this.clickItems.splice(i,1),cc.Tween.stopAllByTarget(t)},i.prototype.changeClickItemAniState=function(t){for(var i=0;i<this.clickItems.length;i++){var e=this.clickItems[i];t?e.pauseAllActions():e.resumeAllActions()}},c([g(cc.Prefab)],i.prototype,"clickItemPrefab",void 0),c([g([cc.Node])],i.prototype,"zimuCArr",void 0),c([g([cc.Node])],i.prototype,"zimuDArr",void 0),c([_],i)}(cc.Component);e.default=y,cc._RF.pop()},{"../../../kit/manager/ResourcesManager":void 0,"../../../kit/system/audio/AudioManager":void 0,"../../../kit/system/timer/TimerSystem":void 0,"../../common/Tigo":void 0,"../../common/notifierCenter":void 0,"./EatBeansConfig":"EatBeansConfig"}]},{},["EatBeans","EatBeansConfig"]);