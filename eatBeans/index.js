window.__require=function t(i,e,n){function o(s,c){if(!e[s]){if(!i[s]){var a=s.split("/");if(a=a[a.length-1],!i[a]){var u="function"==typeof __require&&__require;if(!c&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var l=e[s]={exports:{}};i[s][0].call(l.exports,function(t){return o(i[s][1][t]||t)},l,l.exports,t,i,e,n)}return e[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({EatBeans:[function(t,i,e){"use strict";cc._RF.push(i,"5b2f1FGXfVCI6iOhDZ6DIbv","EatBeans");var n,o=this&&this.__extends||(n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)},s=this&&this.__decorate||function(t,i,e,n){var o,r=arguments.length,s=r<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,i,e,n);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(r<3?o(s):r>3?o(i,e,s):o(i,e))||s);return r>3&&s&&Object.defineProperty(i,e,s),s},c=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))(function(o,r){function s(t){try{a(n.next(t))}catch(i){r(i)}}function c(t){try{a(n.throw(t))}catch(i){r(i)}}function a(t){var i;t.done?o(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(s,c)}a((n=n.apply(t,i||[])).next())})},a=this&&this.__generator||function(t,i){var e,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(i){return a([t,i])}}function a(r){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=i.call(t,s)}catch(c){r=[6,c],n=0}finally{e=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0});var u=t("../../../kit/manager/ResourcesManager"),l=t("../../../kit/system/timer/TimerSystem"),h=t("../../common/notifierCenter"),d=t("../../common/Tigo"),p=cc._decorator,m=p.ccclass,f=p.property,g=[[["day5_1_BigC_idle","day5_1_BigC_JZ"],["day5_1_C_small_idle","day5_1_C_small_JZ"]],[["day5_1_BigD_idle","day5_1_BigD_JZ"],["day5_1_D_small_idle","day5_1_D_small_JZ"]]],_=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.smallcCount=6,i.smalldCount=4,i.bigcCount=6,i.bigdCount=4,i.clickItemPrefab=null,i.zimuCArr=[],i.zimuDArr=[],i.rightNode=null,i.rectNode=null,i.posNodeArr=[],i.spCSpine=null,i.spDSpine=null,i.shadingBg=null,i.clickBtn=null,i.handSpine=null,i.itemContent=null,i.caidaiSpine=null,i.bg=null,i.curZimu="c",i.clickItems=[],i.bigZimuCount=0,i.smallZimuCount=0,i.hasGuidUser=!1,i.guildSoundTimer=null,i}return o(i,t),i.prototype.onLoad=function(){this.initUI(),this.initNative(),d.default.callAppToLoaded()},i.prototype.start=function(){var t=this;this.fixBg(),this.scheduleOnce(function(){t.showZimuSpine()},3)},i.prototype.fixBg=function(){var t=cc.winSize,i=cc.Canvas.instance.designResolution,e=cc.size(i.width,i.height),n=t.width/t.height,o=r({},e);if(this.bg.width/this.bg.height>n){var s=this.bg.width*o.height/this.bg.height;this.bg.width=s,this.bg.height=o.height}else{var c=t.width/e.width;this.bg.width=e.width*c,this.bg.height=e.height*c}this.bg.x=0,this.bg.y=0},i.prototype.addGuildSoundTimer=function(){var t=this;this.guildSoundTimer&&this.clearGuidHand(),this.guildSoundTimer=l.default.instance.doOnce(5e3,function(){cc.isValid(t.node)&&(t.handSpine.active=!0)},this)},i.prototype.clearGuidHand=function(){this.handSpine.active=!1,l.default.instance.clearTimer(this.guildSoundTimer),this.guildSoundTimer=null},i.prototype.initNative=function(){window.webframe={},window.webframe.Notify=new h.default,window.webframe.Notify.listen("callCocos_loaded",function(){console.log(" ===callCocos_loaded=== ")},this,!0)},i.prototype.initUI=function(){this.rightNode=cc.find("right_node",this.node),this.rectNode=cc.find("right_node/rect_node",this.node),this.shadingBg=cc.find("right_node/bg2",this.node),this.clickBtn=cc.find("right_node/button",this.node).getComponent(cc.Button);for(var t=1;t<5;t++){var i=cc.find("right_node/pos_"+t,this.node);this.posNodeArr.push(i)}this.itemContent=cc.find("right_node/item_content",this.node),this.spCSpine=cc.find("right_node/sprite_node/c",this.node).getComponent(sp.Skeleton),this.spDSpine=cc.find("right_node/sprite_node/d",this.node).getComponent(sp.Skeleton),this.handSpine=cc.find("right_node/shou",this.node),this.bg=cc.find("bg",this.node),this.caidaiSpine=cc.find("spineNode",this.node).getComponent(sp.Skeleton),this.handSpine.zIndex=cc.macro.MAX_ZINDEX},i.prototype.showZimuSpine=function(){return c(this,void 0,void 0,function(){var t,i,e,n,o,r=this;return a(this,function(s){switch(s.label){case 0:return t="c"==this.curZimu?this.zimuCArr:this.zimuDArr,this.shadingBg.active=!0,i=cc.winSize.width,e=[i/2+130,i/2-130],t.map(function(t,i){t.x=-e[i],t.scale=2,t.active=!0}),n="c"==this.curZimu?0:1,o=g[n],[4,this.playZimuStartAni(t[0],o[0][0],o[0][1])];case 1:return s.sent(),[4,this.playZimuStartAni(t[1],o[1][0],o[1][1])];case 2:return s.sent(),this.shadingBg.active=!1,[4,this.playZimuMoveAni()];case 3:return s.sent(),this.clickBtn.interactable=!0,this.smallZimuCount=0,this.bigZimuCount=0,this.hasGuidUser?(cc.tween(this.node).repeatForever(cc.tween(this.node).delay(1.2).call(function(){r.createClickItem().then(function(t){r.itemMoveAni(t)})})).start(),this.addGuildSoundTimer()):this.startCreateItem(),[2]}})})},i.prototype.playZimuStartAni=function(t,i,e){var n=this;return new Promise(function(o){n.curZimu,n.scheduleOnce(function(){var n=t.getChildByName("spine").getComponent(sp.Skeleton);n.curCount=0;var r=n.setAnimation(0,i,!1);n.addAnimation(0,e,!1),n.setTrackCompleteListener(r,function(){o()})})})},i.prototype.playZimuMoveAni=function(){var t=this;return new Promise(function(i){var e="c"==t.curZimu?t.zimuCArr:t.zimuDArr;cc.tween(e[0]).to(.5,{x:t.spCSpine.node.x,y:-146,scale:1}).start(),cc.tween(e[1]).to(.5,{x:t.spCSpine.node.x,y:190,scale:1}).call(function(){i()}).start()})},i.prototype.startCreateItem=function(){var t=this;this.createClickItem("texture/icon_big_c5").then(function(i){cc.tween(i).to(3,{position:t.posNodeArr[1].position}).to(.9,{position:t.rectNode.position}).call(function(){t.changeClickItemAniState(!0),t.node.pauseAllActions(),t.handSpine.active=!0,t.addGuildSoundTimer()}).start(),cc.tween(t.node).repeatForever(cc.tween(t.node).delay(1.2).call(function(){t.createClickItem().then(function(i){t.itemMoveAni(i)})})).start()})},i.prototype.randomClickItem=function(){var t="texture/icon_jimu",i=["big","big","small","small","daoju"];this.smallZimuCount>=3?i=["big","big","daoju"]:this.bigZimuCount>=3&&(i=["small","small","daoju"]);var e,n=this.getRandomNum(i.length)-1;if("big"==i[n]){var o="c"==this.curZimu?this.bigcCount:this.bigdCount;e=this.getRandomNum(o),t="texture/icon_big_"+this.curZimu+e}else"small"==i[n]?(o="c"==this.curZimu?this.smallcCount:this.smalldCount,e=this.getRandomNum(o),t="texture/icon_small_"+this.curZimu+e):t="texture/icon_daoju_"+(e=this.getRandomNum(2));return t},i.prototype.getRandomNum=function(t){return Math.floor(Math.random()*t+1)},i.prototype.createClickItem=function(t){return c(this,void 0,void 0,function(){var i,e,n;return a(this,function(o){switch(o.label){case 0:return i=cc.instantiate(this.clickItemPrefab),e=t||this.randomClickItem(),[4,this.loadItemSprite(e)];case 1:return n=o.sent(),i.getComponent(cc.Sprite).spriteFrame=n,i.parent=this.itemContent,i.position=this.posNodeArr[0].position,i.name=e.split("/")[1],"icon_daoju_1"==i.name&&(i.scale=.8),this.clickItems.push(i),[2,i]}})})},i.prototype.loadItemSprite=function(t){return new Promise(function(i){u.default.instance.loadRes("eatBeans",t,u.ResourceType.Normal,cc.SpriteFrame,function(t,e){i(e)})})},i.prototype.itemMoveAni=function(t){var i=this;cc.tween(t).to(3,{position:this.posNodeArr[1].position}).to(1.8,{position:this.posNodeArr[2].position}).to(3,{position:this.posNodeArr[3].position}).call(function(){i.removeClickItem(t),t.destroy()}).start()},i.prototype.onPickBtnClicked=function(){for(var t=this.rectNode.getBoundingBox(),i=0;i<this.clickItems.length;i++){var e=this.clickItems[i];if(t.intersects(e.getBoundingBox())){this.dealClickedItem(e),this.dealSpriteAni(e.name);break}}this.hasGuidUser||(this.hasGuidUser=!0,this.handSpine.active=!1,this.changeClickItemAniState(!1),this.node.resumeAllActions()),this.addGuildSoundTimer()},i.prototype.dealClickedItem=function(t){var i="c"==this.curZimu?this.spCSpine:this.spDSpine;this.removeClickItem(t),cc.tween(t).to(.3,{position:i.node.position.add(cc.v3(0,60)),scale:0}).call(function(){t.destroy()}).start()},i.prototype.dealSpriteAni=function(t){var i,e=this,n="c"==this.curZimu?this.spCSpine:this.spDSpine;t.includes("daoju_2")?(n.setAnimation(0,"zha",!1),i="daoju_2"):t.includes("daoju_1")?(n.setAnimation(0,"ganga",!1),i="daoju_1"):t.includes("small")?(n.setAnimation(0,"chi",!1),i="small",this.smallZimuCount++,this.scheduleOnce(function(){e.dealZimuAni(i)},.5)):t.includes("big")&&(n.setAnimation(0,"chi",!1),i="big",this.bigZimuCount++,this.scheduleOnce(function(){e.dealZimuAni(i)},.5)),n.addAnimation(0,"idle",!0),this.checkComplete()},i.prototype.dealZimuAni=function(t){var i,e,n,o=this,r="c"==this.curZimu?this.zimuCArr:this.zimuDArr,s=[[["day5_1_BigC_1","day5_1_BigC_2","day5_1_BigC_3"],["day5_1_C_small_1","day5_1_C_small_2","day5_1_C_small_3"]],[["day5_1_BigD_1","day5_1_BigD_2","day5_1_BigD_3"],["day5_1_D_small_1","day5_1_D_small_2","day5_1_D_small_3"]]]["c"==this.curZimu?0:1];if("small"==t?(i=r[1],e=s[1][this.smallZimuCount-1],n=this.smallZimuCount):"big"==t&&(i=r[0],e=s[0][this.bigZimuCount-1],n=this.bigZimuCount),!(n>3)&&i){var c=i.getChildByName("shading");n<=3?(c.active=!0,cc.Tween.stopAllByTarget(c),cc.tween(c).delay(.5).call(function(){c.active=!1;var t=i.getChildByName("spine").getComponent(sp.Skeleton);if(e){var r=t.setAnimation(0,e,!1);3==n&&t.setTrackCompleteListener(r,function(){("c"==o.curZimu?o.spCSpine:o.spDSpine).setAnimation(0,"baoge",!1),t.addAnimation(0,"idle",!0)})}}).start()):c.active=!1}},i.prototype.checkComplete=function(){var t=this;this.smallZimuCount>=3&&this.bigZimuCount>=3&&(this.clickBtn.interactable=!1,this.node.stopAllActions(),this.scheduleOnce(function(){"c"==t.curZimu?(t.clearGuidHand(),t.spCSpine.node.active=!1,t.spDSpine.node.active=!0,t.zimuCArr.map(function(t){return t.active=!1}),t.curZimu="d",t.showZimuSpine()):t.gameOverAni()},3))},i.prototype.gameOverAni=function(){cc.log("game over"),this.shadingBg.active=!0;var t=cc.winSize.width,i=[t/6*4+100,t/6*4-100],e=g[0];this.zimuCArr.map(function(t,n){t.y=0==n?0:-27,t.x=-i[n],t.scale=2,t.getChildByName("shading").active=!1,t.active=!0;var o=t.getChildByName("spine").getComponent(sp.Skeleton),r=e[n][1];console.log(" ====== aniName\uff1b ",r),o.setAnimation(0,r,!0)}),i=[t/6*2+100,t/6*2-100],e=g[1],this.zimuDArr.map(function(t,n){t.y=0==n?0:-27,t.x=-i[n],t.scale=2,t.getChildByName("shading").active=!1,t.active=!0;var o=t.getChildByName("spine").getComponent(sp.Skeleton),r=e[n][1];console.log(" ====== aniName\uff1b ",r),o.setAnimation(0,r,!0)}),this.gameOverSoundAndAni()},i.prototype.gameOverSoundAndAni=function(){return c(this,void 0,void 0,function(){var t;return a(this,function(i){switch(i.label){case 0:return[4,this.playZimuEndAni(this.zimuCArr,g[0])];case 1:return i.sent(),[4,this.playZimuEndAni(this.zimuDArr,g[1])];case 2:return i.sent(),this.caidaiSpine.node.active=!0,t=this.caidaiSpine.setAnimation(0,"caidai",!1),this.caidaiSpine.setTrackCompleteListener(t,function(){d.default.callAppToClose("replayOrNext",!0),cc.log("\u6492\u82b1\u7ed3\u675f")}),[2]}})})},i.prototype.playZimuEndAni=function(t,i){return new Promise(function(e){t.map(function(t,n){var o=t.getChildByName("spine").getComponent(sp.Skeleton),r=o.setAnimation(0,i[n][0],!1);o.addAnimation(0,i[n][1],!1),o.setTrackCompleteListener(r,function(){e()})})})},i.prototype.removeClickItem=function(t){var i=this.clickItems.indexOf(t);this.clickItems.splice(i,1),cc.Tween.stopAllByTarget(t)},i.prototype.changeClickItemAniState=function(t){for(var i=0;i<this.clickItems.length;i++){var e=this.clickItems[i];t?e.pauseAllActions():e.resumeAllActions()}},s([f(cc.Prefab)],i.prototype,"clickItemPrefab",void 0),s([f([cc.Node])],i.prototype,"zimuCArr",void 0),s([f([cc.Node])],i.prototype,"zimuDArr",void 0),s([m],i)}(cc.Component);e.default=_,cc._RF.pop()},{"../../../kit/manager/ResourcesManager":void 0,"../../../kit/system/timer/TimerSystem":void 0,"../../common/Tigo":void 0,"../../common/notifierCenter":void 0}]},{},["EatBeans"]);